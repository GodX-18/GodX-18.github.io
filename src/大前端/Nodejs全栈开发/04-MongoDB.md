---
title: MongoDB
icon: mysql
order: 4
category:
  - 前端
tag:
  - 数据库
  - noSQL	
---

## NoSQL 简介

### 诞生的背景

NoSQL是一种非关系型的数据库，它的出现是为了解决传统的关系型数据库在处理大规模、高并发、多样化的数据时遇到的一些问题。NoSQL的诞生背景有以下几个方面：

- 互联网的发展，导致了数据量的爆炸性增长，传统的关系型数据库在存储和处理海量数据时，面临着性能下降、扩展困难、成本高昂等挑战。
- Web2.0的兴起，使得网站的交互性和动态性更强，用户的个人信息、社交网络、地理位置、操作日志等数据呈现出多样化和非结构化的特征，传统的关系型数据库在存储和查询这些数据时，需要复杂的模式设计和转换，效率低下。
- 云计算的普及，促进了分布式系统的发展，分布式系统要求数据库具有良好的水平扩展性和高可用性，传统的关系型数据库由于其固定的模式和强一致性的要求，难以满足分布式系统的需求。
- 业务的不确定性，使得数据库的存储模式需要频繁变更，传统的关系型数据库在修改表结构时，需要耗费大量的时间和资源，影响业务的快速迭代和创新。

NoSQL作为一种新兴的数据库设计方法，旨在为Web应用提供可扩展的高性能数据存储解决方案。NoSQL有多种解释，有人说是“非SQL”，有人说是“不仅仅是SQL”。NoSQL数据库主要有以下几种类型：键值数据库、文档数据库、列族数据库和图数据库。它们各自有自己的特点和适用场景。NoSQL数据库的优点包括设计简单、水平扩展容易、可用性高、灵活性强等。NoSQL数据库的缺点包括一致性较弱、标准化程度低、跨库事务处理困难等。

## 什么是 NoSQL 数据库

::: tip 前置知识

- 关系型数据库：一种用于存储和管理数据的数据库，它把数据组织成表格的形式，每个表格有多个行和列，每行代表一条记录，每列代表一个属性。关系型数据库可以通过主键和外键来建立表格之间的关系，以保证数据的完整性和一致性。常见的关系型数据库有 Oracle、MySQL 和 SQL Server 等。
- 外键：一种用于建立两个表格之间关系的列，它的值必须在另一个表格中的某个列中存在。这个被参照的列通常是主键，也就是唯一标识一个表格中的记录的列。通过外键，可以实现一对多、多对多和一对一的关系。
- 事务：一种用于保证数据库操作的原子性、一致性、隔离性和持久性的机制。原子性是指一个事务中的所有操作要么全部完成，要么全部不完成；一致性是指事务执行前后，数据库的完整性没有被破坏；隔离性是指多个事务并发执行时，不会相互干扰；持久性是指事务完成后，对数据的修改是永久的。
- 数据类型约定：一种用于规定数据的格式和范围的方法。例如，在关系型数据库中，可以定义一个列的数据类型为整数、字符串、日期等，这样就限制了这个列中可以存储什么样的数据。数据类型约定可以提高数据的质量和效率。

- MongoDB 是一种非关系型数据库，也称为文档型数据库，它把数据组织成文档的形式，每个文档都是一个键值对（key-value）的集合，类似于 JSON 对象。MongoDB 不支持外键、事务和数据类型约定，这意味着它更加灵活和简单，但也需要开发者自己来保证数据的完整性和一致性

::::

如果你之前只接触过关系型数据库如 Oracle、Mysql 或 SQL Server，在学习 MongoDB 时可能会感到不安，突然有一款数据库不支持外键，不支持事务，不支持数据类型约定，会给人一种没法用的感觉。



MongoDB 就是这样一款非关系型的数据库，什么叫非关系型？就是把数据直接放进一个大仓库，不标号、不连线、单纯的堆起来。传统数据库由于受到各种关系的累赘，各种数据形式的束缚，难以处理海量数据以及超高并发的业务场景。

为了解决上述问题，必须有一款自废武功，以求在更高层次上突破瓶颈的数据库系统。就像张无忌忘记招式从而学习太极一样，摈弃了固有模式的 MongoDB 才能应对 Facebook 上亿比特的海量数据。

NoSQL(NoSQL = Not Only SQL )，意即"不仅仅是SQL"。

在现代的计算系统上每天网络上都会产生庞大的数据量，这些数据有很大一部分是由关系数据库管理系统（RDBMS）来处理。

1970年 E.F.Codd's提出的关系模型的论文 "A relational model of data for large shared data banks"，这使得数据建模和应用程序编程更加简单。

通过应用实践证明，关系模型是非常适合于客户服务器编程，远远超出预期的利益，今天它是结构化数据存储在网络和商务应用的主导技术。

NoSQL 是一项全新的数据库革命性运动，早期就有人提出，发展至2009年趋势越发高涨。NoSQL的拥护者们提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入。

## NoSQL 的优点和缺点

**优点：**

- 持续可用性：NoSQL 数据库将数据分布在多个服务器和区域中，因此没有单点故障，可以保证数据的高可用性和容错性。
- 查询速度：NoSQL 数据库是非规范化的，无需担心数据重复，特定查询所需的所有信息通常已经存储在一起，无需连接。这可以使查找更容易，尤其是在处理大量数据时。
- 敏捷：NoSQL 数据库的模式是动态的，能够适应不同的数据类型和需求。开发人员无需花费时间和精力进行前期规划即可开始构建数据库，并且可以轻松地添加数据类型和字段，而无需停机。
- 低成本：NoSQL 数据库横向扩展，使扩展容量具有成本效益。与其升级昂贵的硬件，它们可以通过简单地添加商品服务器或云实例来廉价地扩展。

**缺点：**

- 缺乏标准化：不同的 NoSQL 数据库有不同的数据模型、查询语言和接口，缺乏统一的标准和规范。
- 不支持复杂查询：NoSQL 数据库不支持 SQL 查询语言，也不支持关系型数据库中的一些高级功能，如联合、聚合、排序等。
- 不保证事务性：NoSQL 数据库不遵循 ACID 原则，即原子性、一致性、隔离性和持久性，这些原则可以保证关系型数据库中的数据完整性和一致性

## NoSQL 数据库有哪些类型？

### 键值（Key-Value）数据库：

* 一种用于存储和管理数据的数据库，它把数据组织成键值对（key-value）的形式，每个键都是唯一的，可以用来快速地访问或修改对应的值。
* 键值数据库适合存储用户信息、会话、配置等数据，但不支持复杂的查询和事务。
* 常见的键值数据库有 Riak、Redis、Memcached 等。

### 文档（Document-Oriented）数据库：

* 一种用于存储和管理数据的数据库，它把数据组织成文档的形式，每个文档都是一个键值对（key-value）的集合，类似于 JSON 对象。
* 文档数据库可以存储不同的数据类型和结构，适合存储日志、分析、博客等数据，但不支持跨文档的事务。
* 常见的文档数据库有 MongoDB、CouchDB、RavenDB 等。

### 列族（Column-Family）数据库：

* 一种用于存储和管理数据的数据库，它把数据组织成列族（column family）的形式，每个列族存储经常被一起查询的相关数据。
* 列族数据库可以存储大量的稀疏数据，适合存储日志、博客平台等数据，但不支持复杂的查询和事务。
* 常见的列族数据库有 Cassandra、HBase 等。

### 图（Graph-Oriented）数据库：

* 一种用于存储和管理数据的数据库，它把数据组织成图的形式，每个实体都是一个顶点，每个关系都是一条边。
* 图数据库可以存储复杂的关系型数据，适合存储社交网络、推荐系统等数据，但不适合存储非关系型的数据。
* 常见的图数据库有 Neo4J、OrientDB 等。

:::tip 键值数据库和文档数据库的区别

| 项目     | 键值数据库                                                   | 文档数据库                                                   |
| :------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| 定义     | 一种用于存储和管理数据的数据库，它把数据组织成键值对（key-value）的形式，每个键都是唯一的，可以用来快速地访问或修改对应的值 。 | 一种用于存储和管理数据的数据库，它把数据组织成文档的形式，每个文档都是一个键值对（key-value）的集合，类似于 JSON 对象 。 |
| 区别     | 键值数据库的 value 是一个不透明的数据块，只能通过 key 来访问或修改，数据库不知道 value 的内容和结构。键值数据库适合存储简单的数据，查询速度快，但功能有限。 | 文档数据库的 value 是一个结构化的文档，可以是 JSON、XML 等格式，可以通过 key 或者文档中的字段来访问或修改，数据库可以理解 value 的内容和结构。文档数据库可以存储不同的数据类型和结构，查询灵活，但性能较低。 |
| 优点     | - 高性能：键值数据库可以利用内存或 SSD 来提高读写速度。 <br> - 易扩展：键值数据库可以通过分片或复制来实现横向扩展。 <br> - 简单易用：键值数据库无需定义模式或索引，只需提供 key 和 value 即可。 | - 灵活：文档数据库可以存储各种类型和结构的数据，无需预先定义模式。 <br> - 富查询：文档数据库可以支持多种查询语言和操作符，如 MongoDB 的聚合管道、CouchDB 的 MapReduce 等。 <br> - 易集成：文档数据库可以与各种编程语言和工具进行交互，如 Node.js、Python、RESTful API 等。 |
| 缺点     | - 功能有限：键值数据库不支持复杂的查询和事务，也不支持跨 key 的操作。 <br> - 数据冗余：键值数据库无法避免数据重复，可能导致存储空间浪费和数据不一致。 <br> - 安全性低：键值数据库通常没有提供数据加密、访问控制等安全机制。 | - 性能较低：文档数据库由于需要解析文档结构和内容，可能导致读写速度降低。 <br> - 数据不一致：文档数据库由于没有强制的模式约束，可能导致数据格式不统一或错误。 <br> - 缺乏标准化：文档数据库由于没有统一的标准和规范，可能导致不同的实现方式和接口。 |
| 应用场景 | - 用户信息：键值数据库可以用来存储用户的 ID、姓名、密码等信息，并且可以快速地检索或更新。 <br> - 会话管理：键值数据库可以用来存储用户的会话信息，如登录状态、浏览历史等，并且可以实现高可用性和负载均衡。 <br> - 配置管理：键值数据库可以用来存储系统或应用的配置信息，并且可以方便地修改或同步。 | - 日志分析：文档数据库可以用来存储各种类型和格式的日志数据，并且可以进行复杂的查询和分析。 <br> - 内容管理：文档数据库可以用来存储博客、新闻、社交媒体等内容，并且可以支持多种语言和格式。 <br> - 电子商务：文档数据库可以用来存储商品、订单、用户等信息，并且可以实现个性化的推荐和搜索。 |

:::

## NoSQL 与 RDB 该怎么选择

既然 NoSQL 数据库有这么多的优势，那它是否可以直接取代关系型数据库？

NoSQL 并不能完全取代关系型数据库，NoSQL 主要被用来处理大量且多元数据的存储及运算问题。在这样的特性差异下，我们该如何选择合适的数据库以解决数据存储与处理问题呢？这里提供以下几点作为判断依据。

**1、数据模型的关联性要求**

NoSQL 适合模型关联性比较低的应用。因此：

- 如果需要多表关联，则更适合用 RDB
- 如果对象实体关联少，则更适合用 NoSQL 数据库

- 其中 MongoDB 可以支持复杂度相对高的数据结构，能够将相关联的数据以文档的方式嵌入，从而减少数据之间的关联操作

**2、数据库的性能要求**

如果数据量多切访问速度至关重要，那么使用 NoSQL 数据库可能是比较合适的。NoSQL 数据库能通过数据的分布存储大幅地提供存储性能。

**3、数据的一致性要求**

NoSQL 数据库有一个缺点：其在事务处理与一致性方面无法与 RDB 相提并论。

因此，NoSQL 数据库很难同时满足强一致性与高并发性。如果应用对性能有高要求，则 NoSQL 数据库只能做到数据最终一致。

**4、数据的可用性要求**

考虑到数据不可用可能会造成风险，NoSQL 数据库提供了强大的数据可用性（在一些需要快速反馈信息给使用者的应用中，响应延迟也算某种程度的高可用）。

**一个项目并非只选择一种数据库，可以将其拆开设计，将需要 RDB 特性的放到 RDB 中管理，而其它数据放到 NoSQL 中管理。**

## MongDB 简介

### 什么是 MongDB

- 官方文档：https://www.mongodb.com/
- MongoDB 是由 C++ 语言编写的，是一个基于分布式文件存储的开源 NoSQL 数据库系统。
- MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。

- 这会让曾经使用过关系型数据库的人比较容易上手

- MongoDB 将数据存储为一个文档，数据结构由键值(key=>value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。

![image-20230919155347457](https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230919155347457.png)

- MongoDB 的查询功能非常强大

- 不仅支持大部分关系型数据库中的单表查询，还支持范围查询、排序、聚合、MapReduce 等
- MongoDB 的查询语法类似于面相对象的程序语言

### 发展历史

* MongoDB 最初是在 2007 年由 10gen 公司开发的，该公司由 Dwight Merriman、Eliot Horowitz 和 Kevin Ryan 创立，他们当时正在寻找一种可扩展和灵活的数据库解决方案，用于他们的云计算平台 。 
* 在 2009 年，经过近两年的开发，10gen 将 MongoDB 作为一个开源数据库服务器发布，并建立了一个开源社区来运营 MongoDB 。MongoDB 1.0 在 2009 年 2 月发布，提供了大部分基本的查询功能。
*  在 2010 年，10gen 发布了 MongoDB 1.6，这是第四个主要版本，它引入了分片（sharding），这是一种允许自动地在多个节点之间分配和平衡数据的特性。分片使得 MongoDB 能够处理大规模的数据集和高吞吐量的查询。 
* 在 2014 年，MongoDB 收购了 WiredTiger，这是一个由 Keith Bostic 和 Michael Cahill 开发的存储引擎，并将其作为一个新的存储引擎集成到 MongoDB 3.0 中。WiredTiger 显著地提高了 MongoDB 的写入性能和并发性，并解决了之前 MMAP 存储引擎的一些性能瓶颈。 
* 在 2015 年，MongoDB 发布了 MongoDB 3.2，它在聚合框架中添加了一个新的操作符 $lookup。这个操作符使得 MongoDB 能够在多个集合之间执行连接操作，这是一种之前只有在关系型数据库中才有的特性。 
* 在 2017 年，MongoDB 在 NASDAQ 上市，成为 26 年来第一家上市的数据库公司。从那时起，MongoDB 的股价已经增长了四倍多。 
* 在 2018 年，MongoDB 发布了 MongoDB 4.0，它支持多文档 ACID 事务，使其成为第一个支持强事务的 NoSQL 数据库。 
* 在 2018 年，MongoDB 还将其开源许可证更改为 SSPL（Server Side Public License），这要求任何提供 MongoDB 作为服务的服务提供商必须开源其整个软件栈。

### 优点

* 它支持灵活和动态的模式，可以在类似 JSON 的文档中存储复杂和异构的数据类型。 
* 它提供了丰富和强大的查询语言，支持 CRUD 操作、数据聚合、文本搜索、地理空间查询等。 
* 它支持多种类型的索引，如地理空间索引、文本索引、TTL 索引等，以优化不同的查询场景。 <b
* 它支持复制和分片，以实现数据的高可用性和可扩展性。 
* 它支持多种存储引擎，如 WiredTiger、MMAPv1 和 In-Memory 等，以适应不同的工作负载和性能要求。

### 缺点

* 它不支持跨多个文档或集合的复杂事务。 
* 它不支持原生地在多个集合之间进行连接（除了聚合框架中的 $lookup 操作符），这可能需要多次查询或应用层逻辑来执行关系操作。 
* 它由于其文档导向的模型和 BSON 格式，比关系型数据库消耗更多的磁盘空间。 
* 它没有像关系型数据库那样成熟的维护工具。

### 应用场景

MongoDB 适用于各种需要高性能、高可用性、高可扩展性和灵活数据模型的应用场景。一些例子如下： 

* 游戏应用：MongoDB 可以在嵌入式文档中存储游戏用户信息、装备、积分等，并且可以方便地查询和更新。 
* 物流应用：MongoDB 可以在嵌入式数组中存储订单信息、订单状态、物流信息等，并且可以用一次查询来跟踪一个订单的所有变化。 
* 社交应用：MongoDB 可以存储用户信息和用户生成的内容，如帖子和评论。它还可以使用地理空间索引来实现附近的人和地点等功能。 
* 物联网应用：MongoDB 可以存储设备信息和设备报告的日志。它还可以使用聚合框架或 map-reduce 等方法对这些数据进行多维度的分析。 
* 视频流应用：MongoDB 可以存储用户信息和互动信息，如点赞和礼物。

## 安装 MongDB

https://www.mongodb.com/docs/manual/installation/

:::tip

Mac 中使用 brew 安装时，会自动下载最新版本的node，如果你在其他地方安装了node，可能会导致一些问题，例如 nvm。安装后可以运行 `brew uninstall node`来卸载 node,以此保证环境的一致性。

:::

## mongoDB Shell(`mongosh`)

MongoDB Shell是`mongosh`一个功能齐全的 JavaScript 和 Node.js 16.x REPL环境，用于与 MongoDB 部署交互。您可以使用MongoDB Shell直接对数据库测试查询和操作。

### MongoDB Shell与旧版`mongo`Shell

旧版`mongo`shell 在 MongoDB 5.0 中已弃用，并在 MongoDB 6.0 中删除。与旧版 Shell 相比，新的 MongoDB Shell`mongosh`具有许多优势。新外壳改进了：

- Node.js 与 MongoDB 的兼容性
- 语法高亮
- 命令历史
- 记录

一些旧方法不可用或已被`mongosh`. 为了保持向后兼容性，支持的旧方法`mongosh`使用与 shell 中相应方法相同的语法`mongo`。

### 启动 mongo Shell 并连接到 MongoDB

**连接默认端口上的本地 MongoDB 服务**

您可以在没有任何命令行选项的情况下运行 mongo shell，以使用默认端口 `27017` 连接到在本地主机上运行的 MongoDB 实例： 

```bash
mongosh
```

这相当于以下命令：

```bash
mongosh "mongodb://localhost:27017"
```

**连接非默认端口上的本地 MongoDB 服务**

要指定要连接到本地主机的端口，您可以使用：

- 连接字符串与所选端口
- `--port`命令行选项

例如，以下命令连接到在本地主机端口 28015 上运行的部署：

```bash
mongosh "mongodb://localhost:28015"
# 简写
mongosh --port 28015
```

**连接远程主机上的 MongoDB 服务**

要指定远程主机和端口，您可以使用：

- 连接字符串与所选的主机和端口。
- 和命令行选项`--host`。`--port`如果省略该 `--port`选项，`mongosh`则使用默认端口 27017。

例如，以下命令连接到在主机`mongodb0.example.com`和端口 28015 上运行的 MongoDB 部署：

```bash
mongosh "mongodb://mongodb0.example.com:28015"
# 另一种写法
mongosh --host mongodb0.example.com --port 28015
```

**[指定连接选项](https://www.mongodb.com/docs/mongodb-shell/connect/#specify-connection-options)**

指定不同的连接选项以连接到不同类型的部署。官网目前有六种连接选项，这里只列举其中一个说明。

**通过身份验证连接**

要连接到需要身份验证的 MongoDB 部署，请使用 [`--username`](https://www.mongodb.com/docs/mongodb-shell/reference/options/#std-option-mongosh.--username)和[`--authenticationDatabase`](https://www.mongodb.com/docs/mongodb-shell/reference/options/#std-option-mongosh.--authenticationDatabase)选项。`mongosh`提示您输入密码，密码会在您键入时隐藏。

例如，要以数据库用户身份进行身份验证`alice`，`admin` 请运行以下命令：

```bash
mongosh "mongodb://mongodb0.example.com:28015" --username alice --authenticationDatabase admin --password
```

:::tip

注意：如果您指定--password而不输入用户密码，则外壳程序将提示您输入密码。

:::

### 断开连接

要断开与部署的连接并退出`mongosh`，请执行以下操作之一：

- 输入`.exit`、`exit`、 或`exit()`。
- 键入`quit`或`quit()`。
- 按`Ctrl`+ `D`。
- 按`Ctrl`+`C`两次。

### 常用命令

MongoDB Shell是一个交互式的JavaScript接口，可以用来操作MongoDB数据库。以下是一些常用的MongoDB Shell命令的总结：

- 数据库操作
  - `show dbs`：显示所有数据库
  - `db`：显示当前使用的数据库
  - `use <db>`：切换到指定的数据库，如果不存在则创建
  - `db.dropDatabase()`：删除当前数据库
  - `db.copyDatabase(fromdb, todb, fromhost)`：从指定的主机上复制一个数据库到另一个数据库
  - `db.cloneDatabase(fromhost)`：从指定的主机上克隆一个数据库
  - `db.stats()`：显示当前数据库的状态信息
  - `db.version()`：显示当前数据库的版本信息
  - `db.getMongo()`：显示当前数据库的连接机器地址
  - `db.repairDatabase()`：修复当前数据库，清除数据碎片，释放空间
- 集合操作
  - `show collections`：显示当前数据库中的所有集合
  - `db.createCollection(name, options)`：创建一个集合，可以指定选项，如大小、最大文档数等
  - `db.<collection>.drop()`：删除一个集合
  - `db.<collection>.renameCollection(newname)`：重命名一个集合
  - `db.<collection>.stats()`：显示一个集合的状态信息
- 文档操作
  - `db.<collection>.find(query, projection)`：查询一个集合中的文档，可以指定查询条件和投影字段
  - `db.<collection>.findOne(query, projection)`：查询一个集合中的第一个文档，可以指定查询条件和投影字段
  - `db.<collection>.insert(doc)`：向一个集合中插入一个或多个文档
  - `db.<collection>.update(query, update, options)`：更新一个集合中的一个或多个文档，可以指定更新条件、更新内容和选项，如是否多条、是否插入等
  - `db.<collection>.remove(query, justOne)`：删除一个集合中的一个或多个文档，可以指定删除条件和是否只删除一条
  - `db.<collection>.count(query)`：统计一个集合中符合条件的文档数
  - `db.<collection>.distinct(field, query)`：查询一个集合中某个字段的去重值，可以指定查询条件
  - `db.<collection>.aggregate(pipeline, options)`：对一个集合中的文档进行聚合操作，可以指定管道阶段和选项
- 索引操作
  - `db.<collection>.createIndex(keys, options)`：为一个集合创建一个或多个索引，可以指定索引键和选项，如唯一性、过期时间等
  - `db.<collection>.dropIndex(name)`：删除一个集合中的指定索引
  - `db.<collection>.dropIndexes()`：删除一个集合中的所有索引
  - `db.<collection>.getIndexes()`：获取一个集合中的所有索引信息
- 用户操作
  - `show users`：显示当前数据库中的所有用户
  - `show roles`：显示当前数据库中的所有角色
  - `db.createUser(user)`：创建一个用户，可以指定用户名、密码、角色等信息
  - `db.dropUser(username)`：删除一个用户
  - `db.auth(username, password)`：对当前数据库进行认证

以上是一些常用的MongoDB Shell命令，更多详细信息可以参考[官方文档](https://www.cnblogs.com/zhangyangdev/p/11546063.html)或者[这篇文章](https://zhuanlan.zhihu.com/p/101297478)。

## MongoDB 基础概念

### MongoDB 中的数据存储结构

MongoDB是一种面向文档的NoSQL数据库，它的数据存储结构由以下三个部分组成：

- 文档（Document）：文档是MongoDB中最基本的单元，由键值对（key-value）组成，类似于JSON对象。文档的值可以是不同的数据类型，包括数组、对象、日期、二进制等。文档的最大尺寸是16MB。
- 集合（Collection）：集合是一组文档，相当于关系型数据库中的表（Table）。集合是动态的，不需要预先定义文档的结构或字段。集合可以有索引，以提高查询性能。
- 数据库（Database）：数据库是一组集合，相当于关系型数据库中的数据库（Database）。一个MongoDB实例可以承载多个数据库，每个数据库有自己的文件存储空间和权限。

除了上述的存储结构，MongoDB还提供了一种特殊的集合类型，叫做Capped Collection。这种集合有固定的大小，类似于一个循环缓冲区，当空间被填满后，新的插入会覆盖最旧的文档。Capped Collection适合用于存储日志、审计或其他需要按时间顺序访问的数据。

MongoDB支持两种存储引擎：MMAPv1和WiredTiger。存储引擎决定了MongoDB如何在磁盘上组织和管理数据。MMAPv1是MongoDB原生的存储引擎，它使用操作系统的内存映射文件机制来管理数据。WiredTiger是MongoDB 3.0引入的新存储引擎，它使用了更高效的压缩算法和更细粒度的锁机制来提升性能。从MongoDB 3.2开始，WiredTiger成为了默认的存储引擎。

### 数据库

#### 查看数据库列表

```bash
show dbs
```

#### 查看当前数据库

```bash
db
```

MongoDB 中默认的数据库为 test，如果你没有创建新的数据库，集合将存放在 test 数据库中。

有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。

- **admin**：从权限的角度来看，这是"root"数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。
- **local：** 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合
- **config**：当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。

#### 创建与切换数据库

```bash
use  <DATABASE_NAME>
```

:::tip

在 MongoDB 中数据库只有真正的有了数据才会被创建出来。

:::

#### 数据命名规则

- 不区分大小写，但是建议全部小写
- 不能包含空字符。
- 数据库名称不能为空，并且必须少于64个字符。
- Windows 上的命名限制
  - 不能包括 `/\. "$*<>:|?` 中的任何内容
- Unix 和 Linux 上的命名限制
  - 不能包括 `/\. "$` 中的任何字符

#### 删除数据库

1. 使用 use 命令切换到要删除的数据库
2. 使用 `db.dropDatabase()` 删除当前数据库

### 集合

#### 创建集合

1. db.createCollection(name, options)
	* name是集合名称，
	* options是可选参数，可以指定集合的一些属性，如是否固定大小、索引、最大值等
2. db.collection.insertOne/insertMany(document)
	* 插入文档，如果集合不存在，mongodb会自动创建集合

#### 向集合中添加/更新数据

1. db.collection.insert(document)

2. db.collection.save(document)
   * 该方法来保存或更新文档，如果文档有_id字段，则更新该文档，否则向集合中插入新文档
   
   :::tip
   
   从 MongoDB 4.2 版本开始，save 方法已经被弃用，不建议使用
   
   :::

#### 删除集合
1. db.collection.drop()
	* 该方法会返回一个布尔值，表示是否删除成功
2. db.dropDatabase()
	* 该方法来删除整个数据库，该方法会删除当前使用的数据库和所有的集合
#### 查看集合
1. show collections
	* 查看当前数据库中的所有集合
2. show tables
	* 查看当前数据库中的所有集合
3. db.collection.find(query, projection)
	* 该方法来查看集合中的文档，其中query是可选的查询条件，projection是可选的投影条件

### 文档
