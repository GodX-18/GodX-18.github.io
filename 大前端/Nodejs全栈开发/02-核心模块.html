<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.31" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://godx-18.github.io/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/02-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97.html"><meta property="og:site_name" content="çƒœ"><meta property="og:title" content="Node æ ¸å¿ƒæ¨¡å—"><meta property="og:description" content="Path å†…ç½®æ¨¡å—ï¼Œrequire ä¹‹åç›´æ¥ä½¿ç”¨ ç”¨äºå¤„ç†æ–‡ä»¶ / ç›®å½•çš„è·¯å¾„ å¸¸ç”¨ API basename() è·å–è·¯å¾„ä¸­åŸºç¡€åç§° dirname() è·å–è·¯å¾„ä¸­ç›®å½•åç§° extname() è·å–è·¯å¾„ä¸­æ‰©å±•åç§° isAbsolute() è·å–è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ join()æ‹¼æ¥å¤šä¸ªè·¯å¾„ç‰‡æ®µ resolve() è¿”å›ç»å¯¹è·¯å¾„ pasre() è§£æè·¯å¾„..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230104111003358.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-09-27T09:56:32.000Z"><meta property="article:author" content="GodX"><meta property="article:tag" content="nodejs"><meta property="article:modified_time" content="2023-09-27T09:56:32.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Node æ ¸å¿ƒæ¨¡å—","image":["https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230104111003358.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230209100508606.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230209101754160.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230209102121481.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230214070746377.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230217150638035.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230217150655760.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230524135534469.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230529153319630.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230529160823912.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613163514085.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613163732948.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613163831814.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613165751992.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613170854692.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230626165601088.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230801094230718.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230801095136571.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230821165704136.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230822105640426.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230822110759530.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230822111239488.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230824154701076.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230824161252583.png","https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230824161420194.png"],"dateModified":"2023-09-27T09:56:32.000Z","author":[{"@type":"Person","name":"GodX","url":"https://github.com/GodX-18"}]}</script><title>Node æ ¸å¿ƒæ¨¡å— | çƒœ</title><meta name="description" content="Path å†…ç½®æ¨¡å—ï¼Œrequire ä¹‹åç›´æ¥ä½¿ç”¨ ç”¨äºå¤„ç†æ–‡ä»¶ / ç›®å½•çš„è·¯å¾„ å¸¸ç”¨ API basename() è·å–è·¯å¾„ä¸­åŸºç¡€åç§° dirname() è·å–è·¯å¾„ä¸­ç›®å½•åç§° extname() è·å–è·¯å¾„ä¸­æ‰©å±•åç§° isAbsolute() è·å–è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ join()æ‹¼æ¥å¤šä¸ªè·¯å¾„ç‰‡æ®µ resolve() è¿”å›ç»å¯¹è·¯å¾„ pasre() è§£æè·¯å¾„...">
    <link rel="preload" href="/assets/style-CyXSxgyD.css" as="style"><link rel="stylesheet" href="/assets/style-CyXSxgyD.css">
    <link rel="modulepreload" href="/assets/app-oXp7PBbS.js"><link rel="modulepreload" href="/assets/02-æ ¸å¿ƒæ¨¡å—.html-DY9kucoV.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/s.svg" alt><!----><span class="vp-site-name hide-in-pad">çƒœ</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/01-Node%E5%9F%BA%E7%A1%80.html" aria-label="å¤§å‰ç«¯"><span class="font-icon icon iconfont icon-qianduan" style=""></span>å¤§å‰ç«¯<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/%E7%AE%97%E6%B3%95/%E6%95%B0%E7%BB%84/%E6%A1%88%E4%BE%8B.html" aria-label="ç®—æ³•"><span class="font-icon icon iconfont icon-suanfaku" style=""></span>ç®—æ³•<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/%E9%98%85%E8%AF%BB/" aria-label="é˜…è¯»"><span class="font-icon icon iconfont icon-yuedu" style=""></span>é˜…è¯»<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/%E9%9D%A2%E8%AF%95/HTML.html" aria-label="é¢è¯•"><span class="font-icon icon iconfont icon-interview" style=""></span>é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="è¯­è¨€"><span class="title"><span class="font-icon icon iconfont icon-duoyuyan" style=""></span>è¯­è¨€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/%E8%AF%AD%E8%A8%80/TypeScript/" aria-label="TypeScript"><span class="font-icon icon iconfont icon-typescript" style=""></span>TypeScript<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" aria-label="é¡¹ç›®ç®¡ç†"><span class="font-icon icon iconfont icon-xiangmuguanli" style=""></span>é¡¹ç›®ç®¡ç†<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/NPDP/" aria-label="NPDP"><span class="font-icon icon iconfont icon-chanpinjingli" style=""></span>NPDP<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/%E5%81%A5%E8%BA%AB/" aria-label="å¥èº«"><span class="font-icon icon iconfont icon-jianshen" style=""></span>å¥èº«<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å…¶å®ƒ"><span class="title"><span class="font-icon icon iconfont icon-qita" style=""></span>å…¶å®ƒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/%E5%85%B6%E5%AE%83/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" aria-label="è®¾è®¡æ¨¡å¼"><!---->è®¾è®¡æ¨¡å¼<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E5%85%B6%E5%AE%83/%E8%AF%95%E9%AA%8C%E5%9C%BA/" aria-label="è¯•éªŒåœº"><!---->è¯•éªŒåœº<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-base" style=""></span><span class="vp-sidebar-title">åŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-js" style=""></span><span class="vp-sidebar-title">Javascript æ·±åº¦å‰–æ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-gongcheng" style=""></span><span class="vp-sidebar-title">å‰ç«¯å·¥ç¨‹åŒ–å®æˆ˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-vue" style=""></span><span class="vp-sidebar-title">Vueæ¡†æ¶æºç ä¸è¿›é˜¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-react" style=""></span><span class="vp-sidebar-title">React æ¡†æ¶åŸç†ä¸å®æˆ˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-nodejs" style=""></span><span class="vp-sidebar-title">Nodejså…¨æ ˆå¼€å‘</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/01-Node%E5%9F%BA%E7%A1%80.html" aria-label="Node åŸºç¡€"><span class="font-icon icon iconfont icon-structure" style=""></span>Node åŸºç¡€<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/02-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97.html" aria-label="Node æ ¸å¿ƒæ¨¡å—"><span class="font-icon icon iconfont icon-nodeJS" style=""></span>Node æ ¸å¿ƒæ¨¡å—<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/03-%E9%80%9A%E4%BF%A1.html" aria-label="é€šä¿¡"><span class="font-icon icon iconfont icon-rss" style=""></span>é€šä¿¡<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/04-NoSQL.html" aria-label="NoSQL"><span class="font-icon icon iconfont icon-list" style=""></span>NoSQL<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-mysql" style=""></span><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-context" style=""></span><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-activity" style=""></span><span class="vp-sidebar-title">Expressjs</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-command" style=""></span><span class="vp-sidebar-title">Koa</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">GraphQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">EggJs</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-nodeJS" style=""></span>Node æ ¸å¿ƒæ¨¡å—</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/GodX-18" target="_blank" rel="noopener noreferrer">GodX</a></span><span property="author" content="GodX"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-08T08:13:48.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 36 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT36M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category6 clickable" role="navigation">å‰ç«¯</span><!--]--><meta property="articleSection" content="å‰ç«¯"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag3 clickable" role="navigation">nodejs</span><!--]--><meta property="keywords" content="nodejs"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#path">Path</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¸¸ç”¨-api">å¸¸ç”¨ API</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#buffer-ç¼“å†²åŒº">Buffer (ç¼“å†²åŒº)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#è¯ç”ŸèƒŒæ™¯">è¯ç”ŸèƒŒæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åœ¨å“ªå„¿">åœ¨å“ªå„¿ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åšä»€ä¹ˆ">åšä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åˆ›å»ºbuffer">åˆ›å»ºBuffer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#buffer-å®ä¾‹æ–¹æ³•">Buffer å®ä¾‹æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#buffer-çš„é™æ€æ–¹æ³•">Buffer çš„é™æ€æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#è‡ªå®šä¹‰-buffer-ä¹‹-split">è‡ªå®šä¹‰ Buffer ä¹‹ split</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#fs-æ¨¡å—">FS æ¨¡å—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ–‡ä»¶æ“ä½œapi">æ–‡ä»¶æ“ä½œAPI</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ–‡ä»¶æ“ä½œå®ç°-md-è½¬-html">æ–‡ä»¶æ“ä½œå®ç° md è½¬ html</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ–‡ä»¶æ‰“å¼€ä¸å…³é—­">æ–‡ä»¶æ‰“å¼€ä¸å…³é—­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¤§æ–‡ä»¶è¯»å†™æ“ä½œ">å¤§æ–‡ä»¶è¯»å†™æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ–‡ä»¶æ‹·è´è‡ªå®šä¹‰å®ç°-å¤§æ–‡ä»¶">æ–‡ä»¶æ‹·è´è‡ªå®šä¹‰å®ç°ï¼ˆå¤§æ–‡ä»¶ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#ç›®å½•æ“ä½œ-api">ç›®å½•æ“ä½œ API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åˆ›å»ºç›®å½•ä¹‹åŒæ­¥å®ç°">åˆ›å»ºç›®å½•ä¹‹åŒæ­¥å®ç°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åˆ›å»ºç›®å½•ä¹‹å¼‚æ­¥å®ç°">åˆ›å»ºç›®å½•ä¹‹å¼‚æ­¥å®ç°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#é€’å½’åˆ é™¤ç›®å½•-æ¨¡æ‹Ÿ-mkdir">é€’å½’åˆ é™¤ç›®å½•ï¼ˆæ¨¡æ‹Ÿ mkdirï¼‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#æ¨¡å—åŒ–">æ¨¡å—åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å‰ç«¯å¼€å‘ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–">å‰ç«¯å¼€å‘ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#ä»€ä¹ˆæ˜¯æ¨¡å—">ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¸¸è§çš„æ¨¡å—åŒ–è§„èŒƒ">å¸¸è§çš„æ¨¡å—åŒ–è§„èŒƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¨¡å—åŒ–æ€»ç»“">æ¨¡å—åŒ–æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#commonjs">CommonJS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#nodejs-ä¸-commonjs">Nodejs ä¸ CommonJs</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¨¡å—åˆ†ç±»åŠåŠ è½½æµç¨‹">æ¨¡å—åˆ†ç±»åŠåŠ è½½æµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å†…ç½®æ¨¡å—ä¹‹-vm">å†…ç½®æ¨¡å—ä¹‹ VM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#ç¬¬ä¸‰æ–¹æ¨¡å—åŠ è½½æ¨¡æ‹Ÿå®ç°">ç¬¬ä¸‰æ–¹æ¨¡å—åŠ è½½æ¨¡æ‹Ÿå®ç°</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#events-æ¨¡å—">Events æ¨¡å—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#events-ä¸-eventemitter">Events ä¸ EventEmitter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#eventemitter-å¸¸è§-api">EventEmitter å¸¸è§ API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å‘å¸ƒè®¢é˜…æ¨¡å¼">å‘å¸ƒè®¢é˜…æ¨¡å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#æµè§ˆå™¨ä¸­çš„-eventloop">æµè§ˆå™¨ä¸­çš„ EventLoop</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#nodejs-ä¸‹çš„äº‹ä»¶å¾ªç¯">Nodejs ä¸‹çš„äº‹ä»¶å¾ªç¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#nodejs-ä¸æµè§ˆå™¨äº‹ä»¶ç¯çš„åŒºåˆ«">Nodejs ä¸æµè§ˆå™¨äº‹ä»¶ç¯çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#nodejs-äº‹ä»¶ç¯å¸¸è§é—®é¢˜">Nodejs äº‹ä»¶ç¯å¸¸è§é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#stream">Stream</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åº”ç”¨ç¨‹åºä¸­ä¸ºä»€ä¹ˆä½¿ç”¨æµæ¥å¤„ç†æ•°æ®">åº”ç”¨ç¨‹åºä¸­ä¸ºä»€ä¹ˆä½¿ç”¨æµæ¥å¤„ç†æ•°æ®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#nodejs-ä¸­æµçš„åˆ†ç±»">Nodejs ä¸­æµçš„åˆ†ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#nodejs-æµç‰¹ç‚¹">Nodejs æµç‰¹ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åˆä½“éªŒ">åˆä½“éªŒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¯è¯»æµ">å¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å¯å†™æµ">å¯å†™æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åŒå·¥æµ-duplex">åŒå·¥æµï¼ˆDuplexï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#è½¬æ¢æµ-transform">è½¬æ¢æµï¼ˆTransformï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ–‡ä»¶å¯è¯»æµ">æ–‡ä»¶å¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ–‡ä»¶å¯å†™æµ">æ–‡ä»¶å¯å†™æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#write-æ‰§è¡Œæµç¨‹">Write æ‰§è¡Œæµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#drain-ä¸å†™å…¥é€Ÿåº¦">drain ä¸å†™å…¥é€Ÿåº¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#èƒŒå‹æœºåˆ¶">èƒŒå‹æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¨¡æ‹Ÿæ–‡ä»¶å¯è¯»æµ">æ¨¡æ‹Ÿæ–‡ä»¶å¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#é“¾è¡¨ç»“æ„">é“¾è¡¨ç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å•å‘é“¾è¡¨">å•å‘é“¾è¡¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å•å‘é“¾è¡¨å®ç°é˜Ÿåˆ—">å•å‘é“¾è¡¨å®ç°é˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¨¡æ‹Ÿæ–‡ä»¶å¯å†™æµ">æ¨¡æ‹Ÿæ–‡ä»¶å¯å†™æµ</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="path" tabindex="-1"><a class="header-anchor" href="#path"><span>Path</span></a></h2><ul><li>å†…ç½®æ¨¡å—ï¼Œrequire ä¹‹åç›´æ¥ä½¿ç”¨</li><li>ç”¨äºå¤„ç†æ–‡ä»¶ / ç›®å½•çš„è·¯å¾„</li></ul><h3 id="å¸¸ç”¨-api" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨-api"><span>å¸¸ç”¨ API</span></a></h3><ul><li><p>basename() è·å–è·¯å¾„ä¸­åŸºç¡€åç§°</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 *1 @return è¿”å›å€¼å°±æ˜¯æ¥æ”¶è·¯å¾„å½“ä¸­çš„æœ€åä¸€éƒ¨åˆ†
 *2 ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ‰©å±•åï¼Œå¦‚æœæ‰©å±•ååŒ¹é…åˆ™å»é™¤ï¼Œå¦åˆ™ä¸åšæ“ä½œ
 *3 å¤„ç†ç›®çµè·¯å¾„çš„æ—¶å€™å¦‚æœè¯´ï¼Œç»“å°¾å¤„æœ‰è·¯å¾„åˆ†å‰²ç¬¦ï¼Œåˆ™ä¹Ÿä¼šæ”¾å¿½ç•¥æ‰
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// path.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// path</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> <span class="token string">&quot;.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// path.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">&#39;/a/b/c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">&#39;/a/b/c/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>dirname() è·å–è·¯å¾„ä¸­ç›®å½•åç§°</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 *1 @return è¿”å›å€¼å°±æ˜¯æ¥æ”¶è·¯å¾„å½“ä¸­çš„æœ€åä¸€éƒ¨åˆ†çš„æ‰€åœ¨è·¯å¾„
 *2 å¤„ç†ç›®å½•è·¯å¾„çš„æ—¶å€™å¦‚æœè¯´ï¼Œç»“å°¾å¤„æœ‰è·¯å¾„åˆ†å‰²ç¬¦ï¼Œåˆ™ä¼šè¢«å¿½ç•¥æ‰
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/b</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/b</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>extname() è·å–è·¯å¾„ä¸­æ‰©å±•åç§°</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//*1 è·å–è·¯å¾„ä¸­çš„åŸºç¡€åç§°</span>

<span class="token doc-comment comment">/**
 *1 @return è¿”å›å€¼å°±æ˜¯æ¥æ”¶è·¯å¾„å½“ä¸­ç›¸åº”æ–‡ä»¶çš„åç¼€å
 *2 å¤„ç†ç›®å½•è·¯å¾„ä¸­æœ‰å¤šä¸ªç‚¹ï¼Œåˆ™ä¼šåŒ¹é…æœ€åä¸€ä¸ªç‚¹åé¢çš„å†…å®¹
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç©º</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c.js.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .css</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c.js.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>isAbsolute() è·å–è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">&quot;/a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">&quot;///a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token string">&quot;./a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>join()æ‹¼æ¥å¤šä¸ªè·¯å¾„ç‰‡æ®µ</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;a/b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;..&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;..&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a/index.html</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;a/b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a/b/c/index.html</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>resolve() è¿”å›ç»å¯¹è·¯å¾„</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * æ–¹æ³•è¯´æ˜
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> resolve([from],to)
 * from é»˜è®¤æ˜¯è¿è¡Œç›®å½•
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /b</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;/a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /b</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;/a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/b</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­£å¸¸ç”¨æ³•</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>pasre() è§£æè·¯å¾„</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 *1 @return æ¥æ”¶ä¸€ä¸ªè·¯å¾„ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸åŒçš„ä¿¡æ¯
 *2 rootï¼ˆæ ¹è·¯å¾„ï¼‰ dirï¼ˆæœ€åä¸€ä¸ª / çš„ä¸Šä¸€å±‚è·¯å¾„ï¼‰ baseï¼ˆæœ€åä¸€ä¸ª / åçš„æ–‡ä»¶åï¼‰ extï¼ˆæ‰©å±•åï¼‰ nameï¼ˆæ–‡ä»¶åï¼‰
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c.js.css.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;./a/b/c.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>format() åºåˆ—åŒ–è·¯å¾„</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 *1 @return æ¥æ”¶ä¸€ä¸ªè·¯å¾„å¯¹è±¡ï¼ˆpath.parseè¿”å›ï¼‰ï¼Œæ ¹æ®è·¯å¾„å¯¹è±¡ç”Ÿæˆè·¯å¾„
 *2 rootï¼ˆæ ¹è·¯å¾„ï¼‰ dirï¼ˆæœ€åä¸€ä¸ª / çš„ä¸Šä¸€å±‚è·¯å¾„ï¼‰ baseï¼ˆæœ€åä¸€ä¸ª / åçš„æ–‡ä»¶åï¼‰ extï¼ˆæ‰©å±•åï¼‰ nameï¼ˆæ–‡ä»¶åï¼‰
 */</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/b/c</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>normalize() è§„èŒƒåŒ–è·¯å¾„</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;GodX------&gt;log&#39;</span><span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;GodX------&gt;log&#39;</span><span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">&quot;/a///b/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/b/c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;GodX------&gt;log&#39;</span><span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b/../c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/c</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="buffer-ç¼“å†²åŒº" tabindex="-1"><a class="header-anchor" href="#buffer-ç¼“å†²åŒº"><span>Buffer (ç¼“å†²åŒº)</span></a></h2><h3 id="è¯ç”ŸèƒŒæ™¯" tabindex="-1"><a class="header-anchor" href="#è¯ç”ŸèƒŒæ™¯"><span>è¯ç”ŸèƒŒæ™¯</span></a></h3><ul><li>JS è¯­è¨€èµ·åˆæœåŠ¡äºæµè§ˆå™¨å¹³å°ï¼Œä¸»è¦æ“ä½œçš„æ•°æ®ç±»å‹æ˜¯å­—ç¬¦ä¸²</li><li>Nodejs çš„å‡ºç°ï¼Œä½¿å¾— JSå¯ä»¥åšä¸€äº› IO æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶çš„è¯»å†™ã€ç½‘ç»œæœåŠ¡ä¸­æ•°æ®çš„ä¼ è¾“</li><li>IO è¡Œä¸ºæ“ä½œçš„å°±æ˜¯äºŒè¿›åˆ¶æ•°æ®</li><li>Stream æµæ“ä½œå¹¶é Nodejs ç‹¬åˆ›</li><li>æµæ“ä½œé…åˆç®¡é“å®ç°æ•°æ®åˆ†æ®µä¼ è¾“</li><li>æ•°æ®çš„ç«¯åˆ°ç«¯ä¼ è¾“ä¼šæœ‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</li><li>ç”Ÿäº§å’Œæ¶ˆè´¹çš„è¿‡ç¨‹å¾€å¾€å­˜åœ¨ç­‰å¾…ï¼Œäº§ç”Ÿç­‰å¾…æ—¶æ•°æ®æ”¾åœ¨å“ªå„¿ï¼Ÿ</li></ul><h3 id="æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#æ˜¯ä»€ä¹ˆ"><span>æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><ul><li><p>æ— é¡» require çš„ä¸€ä¸ªå…¨å±€å˜é‡</p></li><li><p>Nodejs ä¸­ Buffer æ˜¯ä¸€ç‰‡ç‹¬ç«‹çš„å†…å­˜ç©ºé—´</p></li></ul><h3 id="åœ¨å“ªå„¿" tabindex="-1"><a class="header-anchor" href="#åœ¨å“ªå„¿"><span>åœ¨å“ªå„¿ï¼Ÿ</span></a></h3><ul><li>ä¸å ç”¨ V8 çš„å †å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯ç”± V8 çš„ GC æ¥ç®¡ç†å’Œå›æ”¶</li></ul><h3 id="åšä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#åšä»€ä¹ˆ"><span>åšä»€ä¹ˆï¼Ÿ</span></a></h3><ul><li>å®ç° Nodejs å¹³å°ä¸‹çš„äºŒè¿›åˆ¶æ•°æ®æ“ä½œ</li><li>ä¸€èˆ¬é…åˆ Stream æµä½¿ç”¨ï¼Œå……å½“æ•°æ®ç¼“å†²åŒº</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230104111003358.png" alt="image-20230104111003358" tabindex="0" loading="lazy"><figcaption>image-20230104111003358</figcaption></figure><h3 id="åˆ›å»ºbuffer" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºbuffer"><span>åˆ›å»ºBuffer</span></a></h3><ul><li>allocï¼šåˆ›å»ºæŒ‡å®šå­—èŠ‚å¤§å°çš„ buffer</li><li>allocUnsafeï¼šåˆ›å»ºæŒ‡å®šå¤§å°çš„ buffer(ä¸å®‰å…¨ï¼‰ï¼ŒåŒ…å«ä¸€äº›ç©ºé—´ç¢ç‰‡</li><li>fromï¼šæ¥æ”¶æ•°æ®ï¼Œåˆ›å»º bufferï¼Œé»˜è®¤ä½¿ç”¨ utf-8 ç¼–ç  <ul><li>åªæ¥æ”¶ä¸‰ç§æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ã€Buffer</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> b1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  &lt;Buffer 00 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 25 10 00&gt; å¸¦æœ‰å…¶å®ƒæ•°æ®</span>

<span class="token keyword">const</span> b3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;çƒœ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b4 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xe7</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0x9c</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer e7 83 9c&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b4<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°† Buffer æ ¼å¼è½¬æ¢æˆ utf-8</span>

<span class="token keyword">const</span> b5 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b6 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>b5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ·±æ‹·è´ï¼Œæ ¹æ®ä¼ å…¥ Buffer çš„é•¿åº¦å’Œå†…å®¹ï¼Œå¼€è¾Ÿå…¨æ–°çš„å†…å­˜</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 00 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b6<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 00 00 00&gt;</span>

b5<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 11 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b6<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 00 00 00&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="buffer-å®ä¾‹æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#buffer-å®ä¾‹æ–¹æ³•"><span>Buffer å®ä¾‹æ–¹æ³•</span></a></h3><ul><li><p>fillï¼šä½¿ç”¨æ•°æ®å¡«å…… bufferï¼Œä¼šé‡å¤å¡«å……ï¼Œç›´åˆ°å¡«æ»¡</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">let</span> fillBuf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> writeBuf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * fill æ–¹æ³•è¯´æ˜
 * <span class="token keyword">@description</span>: fill(name,from,to)
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">name</span> è§£ç ç±»å‹
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">from</span> ä»ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹å¡«å……
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">to</span> å¡«å……åˆ°ç¬¬å‡ ä¸ªå­—èŠ‚ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰
 */</span>

fillBuf<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> fillBuf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 00 31 32 33 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> fillBuf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// GodX------&gt;log 123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>writeï¼šå‘ buffer ä¸­å†™å…¥æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * write æ–¹æ³•è¯´æ˜
 * <span class="token keyword">@description</span>: writ(name,from,to)
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">name</span> è§£ç ç±»å‹
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">from</span> ä»ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹å†™å…¥
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">to</span> å†™å…¥åˆ°ç¬¬å‡ ä¸ªå­—èŠ‚ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰
 */</span>

writeBuf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> writeBuf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// GodX------&gt;log &lt;Buffer 00 31 32 33 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> writeBuf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>toString: ä» buffer ä¸­æå–æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * toString æ–¹æ³•è¯´æ˜
 * <span class="token keyword">@description</span>: toString(name,from,to)
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">name</span> è§£ç ç±»å‹
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">from</span> ä»ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹æˆªå–
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">to</span> æˆªå–åˆ°ç¬¬å‡ ä¸ªå­—èŠ‚ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰
 */</span>

<span class="token keyword">let</span> a1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;æœ±çƒœç‰›æ‰¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ªä¸­æ–‡ä¸‰ä¸ªå­—èŠ‚</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer e6 9c b1 e7 83 9c e7 89 9b e6 89 b9&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çƒœç‰›</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>sliceï¼šæˆªå– buffer</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * slice æ–¹æ³•è¯´æ˜
 * <span class="token keyword">@description</span>: åŒ slice
 */</span>

<span class="token keyword">let</span> a2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;æœ±çƒœç‰›æ‰¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ªä¸­æ–‡ä¸‰ä¸ªå­—èŠ‚</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> a2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer e7 83 9c e7 89 9b e6 89 b9&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a3<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çƒœç‰›æ‰¹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>indexOfï¼šåœ¨ buffer ä¸­æŸ¥æ‰¾æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * indexOf æ–¹æ³•è¯´æ˜
 * <span class="token keyword">@description</span>: åŒ indexOf
 * <span class="token keyword">@return</span> åŒ¹é…å­—èŠ‚æ‰€åœ¨ä½ç½®
 */</span>

<span class="token keyword">let</span> a4 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;zxæœ±çƒœç‰›æ‰¹,çƒœlove&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a4<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a4<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;çƒœ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a4<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;çƒœ&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>copy: æ‹·è´ buffer ä¸­çš„æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">let</span> b1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;çƒœç¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 00 00 00 00 00 00&gt;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: æ‹·è´ Buffer
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span> <span class="token parameter">ç¬¬ä¸€ä¸ªï¼š</span> æ‹·è´å­˜æ”¾çš„ä½ç½®
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Number<span class="token punctuation">}</span></span> <span class="token parameter">ç¬¬äºŒä¸ªï¼š</span> æ‹·è´åˆ°å­˜æ”¾ Buffer ç¬¬å‡ ä¸ªå­—èŠ‚
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Number<span class="token punctuation">}</span></span> <span class="token parameter">ç¬¬ä¸‰ä¸ªï¼š</span> æ‹·è´æ•°æ®æºçš„å¼€å§‹å­—èŠ‚åºåˆ—
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Number<span class="token punctuation">}</span></span> <span class="token parameter">ç¬¬å››ä¸ªï¼š</span> æ‹·è´æ•°æ®æºçš„ç»“æŸå­—èŠ‚åºåˆ—
 * <span class="token keyword">@createTime</span>: 2023/01/08 10:20:49
 */</span>

b2<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>b1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 00 00 00 e7 a5 9e&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¥</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="buffer-çš„é™æ€æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#buffer-çš„é™æ€æ–¹æ³•"><span>Buffer çš„é™æ€æ–¹æ³•</span></a></h3><ul><li><p>concat ï¼šå°†å¤šä¸ª buffer æ‹¼æ¥æˆä¸€ä¸ªæ–°çš„ buffer</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;å•ç‚¹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> a2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;ç™»å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> b1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®š buffer çš„é•¿åº¦</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å•ç‚¹ç™»å½•</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> b2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å•ç‚¹ç™»</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>isBufferï¼šåˆ¤æ–­å½“å‰æ•°æ®æ˜¯å¦ä¸º buffer</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;GodX------&gt;log&#39;</span><span class="token punctuation">,</span>Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="è‡ªå®šä¹‰-buffer-ä¹‹-split" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰-buffer-ä¹‹-split"><span>è‡ªå®šä¹‰ Buffer ä¹‹ split</span></a></h3><ul><li><p>Buffer çš„å¤§å°ï¼ˆé•¿åº¦ï¼‰æ˜¯å›ºå®šçš„ï¼ˆåœ¨åˆ›å»ºæ—¶ç¡®å®šï¼‰ï¼Œæ— æ³•æ›´æ”¹ã€‚</p></li><li><p>åœ¨åŸç”ŸNodeçš„Bufferä¸­<strong>ä¸èƒ½</strong>ç›´æ¥ä½¿ç”¨splitæ–¹æ³•ï¼Œ ä¼šæŠ¥ä¸‹é¢çš„é”™è¯¯,ä¸€å®šè¦è‡ªå·±å»å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œä¸”æŒ‚è½½åˆ°åŸå‹é“¾ä¸Š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">split</span> is not a <span class="token keyword">function</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">Buffer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>split <span class="token operator">=</span> <span class="token class-name">Buffer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>split <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">seq</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å­˜å‚¨æœ€ç»ˆåˆ‡å‰²çš„å†…å®¹</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// å½“å‰ä½ç½®--</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// pos--åœ¨bufferä¸­æ‰¾åˆ°æŸä¸ªç¬¦åˆseqæ¡ä»¶ç‰‡æ®µçš„ç´¢å¼•ä½ç½®</span>
  <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>seq<span class="token punctuation">,</span> current<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åœ¨è¿™ä¸ªä½ç½®æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å†…å®¹</span>
    position <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>seq<span class="token punctuation">,</span> current<span class="token punctuation">)</span>

    <span class="token comment">// å°†ç¬¦åˆæ¡ä»¶çš„å‰é¢ä¸€æ®µbufferåˆ‡å‡ºæ¥</span>
    <span class="token keyword">let</span> prevBuffer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> position<span class="token punctuation">)</span>

    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>prevBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ç°åœ¨ä»æ–°çš„ä½ç½®å¼€å§‹ç»§ç»­æ‰¾</span>
    current <span class="token operator">=</span> position <span class="token operator">+</span> seq<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ä¸Šé¢whileç»“æŸï¼Œè¡¨ç¤ºå†ä¹Ÿæ‰¾ä¸åˆ°ç¬¦åˆseqçš„bufferäº†ï¼Œç°åœ¨éœ€è¦å°†æœ€åä¸€æ®µbufferè£…è¿›æ•°ç»„</span>
  arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æµ‹è¯•</span>
<span class="token keyword">let</span>  buf  <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&#39;1,2,3,4,5&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> arr <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬ä¸€æ®µbufferï¼Œè½¬æˆå­—ç¬¦ä¸²--ã€‹&quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬2æ®µbufferï¼Œè½¬æˆå­—ç¬¦ä¸²--ã€‹&quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬3æ®µbufferï¼Œè½¬æˆå­—ç¬¦ä¸²--ã€‹&quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fs-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#fs-æ¨¡å—"><span>FS æ¨¡å—</span></a></h2><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230209100508606.png" alt="image-20230209100508606" tabindex="0" loading="lazy"><figcaption>image-20230209100508606</figcaption></figure><ul><li>FS æ˜¯å†…ç½®æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„ API</li><li>ä»£ç å±‚é¢ä¸Š fs åˆ†ä¸ºåŸºæœ¬æ“ä½œç±»å’Œå¸¸ç”¨ API</li></ul><h3 id="å‰ç½®çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#å‰ç½®çŸ¥è¯†"><span>å‰ç½®çŸ¥è¯†</span></a></h3><ul><li>æƒé™ä½:ç”¨æˆ·å¯¹äºæ–‡ä»¶æ‰€å…·å¤‡çš„æ“ä½œæƒé™<br><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230209101754160.png" alt="image-20230209101754160" loading="lazy"><br><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230209102121481.png" alt="" loading="lazy"></li><li>æ ‡è¯†ç¬¦ï¼ˆflag æ“ä½œç¬¦ï¼‰ <ul><li>rï¼šå¯è¯»</li><li>wï¼šå¯å†™</li><li>sï¼šåŒæ­¥</li><li>+ï¼šæ‰§è¡Œç›¸åæ“ä½œ</li><li>xï¼šè¡¨ç¤ºæ’å®ƒæ“ä½œ</li><li>aï¼šè¡¨ç¤ºè¿½åŠ æ“ä½œ</li></ul></li><li>æ–‡ä»¶æè¿°ç¬¦ <ul><li>fdï¼šå°±æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…ç»™è¢«æ‰“å¼€æ–‡ä»¶çš„æ ‡è¯†</li></ul></li></ul><h3 id="æ–‡ä»¶æ“ä½œapi" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶æ“ä½œapi"><span>æ–‡ä»¶æ“ä½œAPI</span></a></h3><ul><li><p>readFile:ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>writeFile:å‘æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥æ•°æ®</p><ul><li>å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œå°†æ–°å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶</li><li>r+ : ä¸ä¼šæ¸…ç©ºï¼Œç›´æ¥ä»é›¶å¼€å§‹å†™å…¥ï¼ˆè¦†ç›–ï¼‰</li><li>w+ï¼šå…ˆæ¸…ç©ºåå†™å…¥</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>
  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;888&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token number">438</span><span class="token punctuation">,</span>
    <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">&quot;r+&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf-8&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX--&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>appendFile:è¿½åŠ çš„æ–¹å¼å‘æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>
  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">&quot;r+&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>copyFile: å°†æŸä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®æ‹·è´è‡³å¦ä¸€æ–‡ä»¶</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//* copyFile</span>
fs<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;path.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ“ä½œæˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>watchFileï¼šå¯¹æŒ‡å®šæ–‡ä»¶è¿›è¡Œç›‘æ§</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">watchFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">interval</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">curr<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>mtime <span class="token operator">!==</span> prev<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ–‡ä»¶è¢«ä¿®æ”¹äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å–æ¶ˆç›‘æ§</span>
    fs<span class="token punctuation">.</span><span class="token function">unwatchFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="æ–‡ä»¶æ“ä½œå®ç°-md-è½¬-html" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶æ“ä½œå®ç°-md-è½¬-html"><span>æ–‡ä»¶æ“ä½œå®ç° md è½¬ html</span></a></h3><p>å®ç°æ€è·¯ï¼š</p><ul><li>è¯»å– md å’Œ css å†…å®¹</li><li>å°†ä¸Šè¿°è¯»å–å‡ºæ¥çš„å†…å®¹æ›¿æ¢å ä½ç¬¦ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ç»ˆéœ€è¦å±•çš„ Html å­—ç¬¦ä¸²</li><li>å°†ä¸Šè¿°çš„ Html å­—ç¬¦å†™å…¥åˆ°æŒ‡å®šçš„ Html æ–‡ä»¶ä¸­</li><li>ç›‘å¬ md æ–‡æ¡£å†…å®¹çš„å˜ç»ï¼Œç„¶åæ›´æ–° html å†…å®¹</li><li>ä½¿ç”¨ browser-sync æ¥å®æ—¶æ˜¾ç¤º Html å†…å®¹</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> marked <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;marked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> browserSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;browser-sync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ mdåœ°å€</span>
<span class="token keyword">let</span> mdPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cssPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;github.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹åŒ–æ ·å¼</span>
<span class="token keyword">let</span> htmlPath <span class="token operator">=</span> mdPath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>mdPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mdPath<span class="token punctuation">,</span> cssPath<span class="token punctuation">,</span> htmlPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬</span>
fs<span class="token punctuation">.</span><span class="token function">watchFile</span><span class="token punctuation">(</span>mdPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">cur<span class="token punctuation">,</span> pre</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>mtime <span class="token operator">!==</span> pre<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>mdPath<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å°† md--&gt;html</span>
      <span class="token keyword">let</span> htmlStr <span class="token operator">=</span> <span class="token function">marked</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>cssPath<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> retHtml <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{{content}}&quot;</span><span class="token punctuation">,</span> htmlStr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;{{style}}&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//   å°†ä¸Šè¿°å†…å®¹å†™å…¥åˆ°æŒ‡å®šçš„htmlæ–‡ä»¶ä¸­ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­å±•ç¤º</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>htmlPath<span class="token punctuation">,</span> retHtml<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;html create successful&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

browserSync<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">server</span><span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>htmlPath<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// htmlæ¨¡æ¿</span>
<span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> 
    &lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;&lt;/title&gt;
        &lt;style&gt;
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 1000px;
                margin: 0 auto;
                padding: 45px;
            }
            @media (max-width: 750px) {
                .markdown-body {
                    padding: 15px;
                }
            }
            {{style}}
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&quot;markdown-body&quot;&gt;
            {{content}}
        &lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ–‡ä»¶æ‰“å¼€ä¸å…³é—­" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶æ‰“å¼€ä¸å…³é—­"><span>æ–‡ä»¶æ‰“å¼€ä¸å…³é—­</span></a></h3><ul><li>è¾¹å†™è¾¹è¯»çš„æ“ä½œæ–¹å¼ï¼ˆæµè¯»å–ï¼‰ï¼Œé€‚ç”¨äºå¤§æ–‡ä»¶çš„è¯»å–</li><li><code>fs.readFile()</code>ï¼Œ<code>fs.readFileSync()</code>å’Œ<code>fsPromises.readFile()</code>åœ¨è¿”å›æ•°æ®å‰è¯»å–å†…å­˜ä¸­æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œä¸é€‚ç”¨äºå¤§æ–‡ä»¶çš„è¯»å–</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–‡ä»¶æè¿°ç¬¦</span>
  fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å¼€æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤§æ–‡ä»¶è¯»å†™æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å¤§æ–‡ä»¶è¯»å†™æ“ä½œ"><span>å¤§æ–‡ä»¶è¯»å†™æ“ä½œ</span></a></h3><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230214070746377.png" alt="image-20230214070746377" tabindex="0" loading="lazy"><figcaption>image-20230214070746377</figcaption></figure><p><strong>fs.read</strong></p><ul><li>ç›¸å½“äºå°†ç£ç›˜ä¸­çš„æ•°æ®è¯»å–å‡ºæ¥æ”¾åˆ°ç¼“å†²åŒºå½“ä¸­</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token parameter">rfd</span> å®šä½å½“å‰è¢«æ‰“å¼€çš„æ–‡ä»¶
 * <span class="token keyword">@param</span> <span class="token parameter">buf</span> ç”¨äºè¡¨ç¤ºå½“å‰ç¼“ä¸­åŒº
 * <span class="token keyword">@param</span> <span class="token parameter">offset</span> è¡¨ç¤ºå½“å‰ä» buf çš„å“ªä¸ªä½ç½®å¼€å§‹çƒ­è¡Œå†™å…¥
 * <span class="token keyword">@param</span> <span class="token parameter">length</span> è¡¨ç¤ºå½“å‰æ¬¡å†™å…¥çš„é•¿åº¦
 * <span class="token keyword">@param</span> <span class="token parameter">position</span> è¡¨ç¤ºå½“å‰ä»æ–‡ä»¶çš„å“ªä¸ªä½ç½®å¼€å§‹è¯»æ“ä½œ
 */</span>

<span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> rfd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>rfd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> readBytes<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>readBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>fs.write</strong></p><ul><li>å°†ç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ä¸­</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;b.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> wfd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wfd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> written<span class="token punctuation">,</span> buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>written<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>wfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ–‡ä»¶æ‹·è´è‡ªå®šä¹‰å®ç°-å¤§æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶æ‹·è´è‡ªå®šä¹‰å®ç°-å¤§æ–‡ä»¶"><span>æ–‡ä»¶æ‹·è´è‡ªå®šä¹‰å®ç°ï¼ˆå¤§æ–‡ä»¶ï¼‰</span></a></h3><ul><li>copyFile æ˜¯åŸºäº readFile å’Œ writeFileå†™çš„ï¼Œå±äºä¸€æ¬¡æ€§è¯»å†™æ“ä½œï¼Œä¸é€‚ç”¨äºå¤§ä½“ç§¯æ–‡ä»¶çš„è¯»å†™</li></ul><p><strong>å…·ä½“æ­¥éª¤</strong></p><ol><li>æ‰“å¼€ a æ–‡ä»¶ï¼Œåˆ©ç”¨ read å°†æ•°æ®ä¿å­˜åˆ° buffer æš‚å­˜èµ·æ¥</li><li>æ‰“å¼€ b æ–‡ä»¶ï¼Œåˆ©ç”¨ write å°† buffer ä¸­æ•°æ®å†™å…¥åˆ° b æ–‡ä»¶ä¸­</li></ol><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">let</span> buff <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">BUFFER_SIZE</span> <span class="token operator">=</span> buff<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// buffer å¤§å°</span>
<span class="token keyword">let</span> readOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> rfd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;b.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> wfd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>rfd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">BUFFER_SIZE</span><span class="token punctuation">,</span> readOffset<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> readBytes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>readBytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// å¦‚æœæ¡ä»¶æˆç«‹ï¼Œè¯´æ˜å†…å®¹å·²ç»è¯»å–å®Œæ¯•</span>
          fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>rfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>wfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ‹·è´å®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readOffset <span class="token operator">+=</span> readBytes<span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wfd<span class="token punctuation">,</span> buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> readBytes<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> written</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> written<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç›®å½•æ“ä½œ-api" tabindex="-1"><a class="header-anchor" href="#ç›®å½•æ“ä½œ-api"><span>ç›®å½•æ“ä½œ API</span></a></h3><ul><li><p>access: åˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å…·æœ‰æ“ä½œæƒé™</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰æ“ä½œæƒé™&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>stat:è·å–ç›®å½•åŠæ–‡ä»¶ä¿¡æ¯</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> statObj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> size<span class="token punctuation">,</span> isFile <span class="token punctuation">}</span> <span class="token operator">=</span> statObj<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> statObj<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> statObj<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>mkdirï¼šåˆ›å»ºç›®å½•</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// recursiveï¼šä¸º true æ—¶ï¼Œé€’å½’åˆ›å»ºç›®å½•</span>
fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;yy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logåˆ›å»ºæˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>rmdir:åˆ é™¤ç›®å½•</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªèƒ½åˆ é™¤éç©ºçš„ç›®å½•</li><li>recursive ä¸º true æ—¶ï¼Œé€’å½’åˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;aa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ é™¤å¤±è´¥&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ é™¤æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>readdirï¼šè¯»å–ç›®å½•ä¸­å†…å®¹</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;markdownToHtml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;è¯»å–å¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230217150638035.png" alt="image-20230217150638035" tabindex="0" loading="lazy"><figcaption>image-20230217150638035</figcaption></figure><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230217150655760.png" alt="image-20230217150655760" tabindex="0" loading="lazy"><figcaption>image-20230217150655760</figcaption></figure></li><li><p>unlink: åˆ é™¤æŒ‡å®šæ–‡ä»¶</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;b.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ é™¤æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="åˆ›å»ºç›®å½•ä¹‹åŒæ­¥å®ç°" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç›®å½•ä¹‹åŒæ­¥å®ç°"><span>åˆ›å»ºç›®å½•ä¹‹åŒæ­¥å®ç°</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeDirSync</span><span class="token punctuation">(</span><span class="token parameter">dirPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// path.sepï¼šwindows ç¯å¢ƒä¸‹ä¸º â€˜\\â€™ï¼Œlinux ä¸‹ä¸º â€˜/â€™</span>
  <span class="token keyword">let</span> items <span class="token operator">=</span> dirPath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dir <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">accessSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">makeDirSync</span><span class="token punctuation">(</span><span class="token string">&quot;a/b/c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºç›®å½•ä¹‹å¼‚æ­¥å®ç°" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç›®å½•ä¹‹å¼‚æ­¥å®ç°"><span>åˆ›å»ºç›®å½•ä¹‹å¼‚æ­¥å®ç°</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mkDir</span><span class="token punctuation">(</span><span class="token parameter">dirPath<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parts <span class="token operator">=</span> dirPath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºå®Œæ¯•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å½“å‰åˆ›å»ºçš„ç›®å½•</span>
    <span class="token keyword">let</span> current <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ¤æ–­æœ‰æ— æƒé™åˆ›å»ºï¼ˆå¦‚æœæŠ¥é”™åˆ™è¯´æ˜ç›®å½•ä¸å­˜åœ¨ï¼‰</span>
    fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºå½“å‰ç›®å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ›å»ºä¸‹ä¸€çº§ç›®å½•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>å°† access å’Œ mkdir å¤„ç†æˆ async/await é£æ ¼</strong></em></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> access <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>access<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mkdir <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>mkdir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">myMkdir</span><span class="token punctuation">(</span><span class="token parameter">dirPath<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parts <span class="token operator">=</span> dirPath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> index <span class="token operator">&lt;=</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> current <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">access</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">mkdir</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é€’å½’åˆ é™¤ç›®å½•-æ¨¡æ‹Ÿ-mkdir" tabindex="-1"><a class="header-anchor" href="#é€’å½’åˆ é™¤ç›®å½•-æ¨¡æ‹Ÿ-mkdir"><span>é€’å½’åˆ é™¤ç›®å½•ï¼ˆæ¨¡æ‹Ÿ mkdirï¼‰</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">myRmdir</span><span class="token punctuation">(</span><span class="token parameter">dirPath<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> statObj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>statObj<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç›®å½• -----&gt; ç»§ç»­è¯»å–</span>
      fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> dirs <span class="token operator">=</span> files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> dirs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> current <span class="token operator">=</span> dirs<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token function">myRmdir</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ–‡ä»¶ ---&gt; ç›´æ¥åˆ é™¤</span>
      fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">myRmdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;yyy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ¨¡å—åŒ–" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—åŒ–"><span>æ¨¡å—åŒ–</span></a></h2><h3 id="å‰ç«¯å¼€å‘ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–" tabindex="-1"><a class="header-anchor" href="#å‰ç«¯å¼€å‘ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–"><span>å‰ç«¯å¼€å‘ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–ï¼Ÿ</span></a></h3><p><strong>ä¼ ç»Ÿå¼€å‘å¸¸è§é—®é¢˜</strong></p><ul><li>å‘½åå†²çªå’Œæ±¡æŸ“</li><li>ä»£ç å†—ä½™ï¼Œæ— æ•ˆè¯·æ±‚å¤š</li><li>æ–‡ä»¶é—´çš„ä¾èµ–å…³ç³»å¤æ‚</li></ul><p>ä»¥ä¸Šé—®é¢˜å¯¼è‡´é¡¹ç›®éš¾ä»¥ç»´æŠ¤ä¸æ–¹ä¾¿å¤ç”¨</p><h3 id="ä»€ä¹ˆæ˜¯æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ¨¡å—"><span>ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Ÿ</span></a></h3><ul><li>å°†ä¸€ä¸ªå¤§ç¨‹åºæ‹†åˆ†æˆäº’ç›¸ä¾èµ–çš„å°æ–‡ä»¶ï¼Œå†ç”¨ç®€å•çš„æ–¹æ³•æ‹¼è£…èµ·æ¥</li><li>æ¯ä¸ªæ¨¡å—çš„å†…éƒ¨æ•°æ®å’Œæ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œåªæ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼ˆæ¥å£ï¼‰ä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨</li></ul><h3 id="å¸¸è§çš„æ¨¡å—åŒ–è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#å¸¸è§çš„æ¨¡å—åŒ–è§„èŒƒ"><span>å¸¸è§çš„æ¨¡å—åŒ–è§„èŒƒ</span></a></h3><ul><li>commonjs</li><li>AMD</li><li>CMD</li><li>ES modules</li></ul><h3 id="æ¨¡å—åŒ–æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—åŒ–æ€»ç»“"><span>æ¨¡å—åŒ–æ€»ç»“</span></a></h3><ul><li>æ¨¡å—åŒ–æ˜¯å‰ç«¯èµ°å‘å·¥ç¨‹åŒ–ä¸­çš„é‡è¦ä¸€ç¯</li><li>æ—©æœŸ JS è¯­è¨€å±‚é¢æ²¡æœ‰æ¨¡å—åŒ–è§„èŒƒ</li><li>Commonjsã€AMDã€CMD éƒ½æ˜¯æ¨¡å—åŒ–è§„èŒƒ</li><li>ES6 ä¸­å°†æ¨¡å—åŒ–çº³å…¥æ ‡å‡†è§„èŒƒ</li><li>å½“ä¸‹å¸¸ç”¨è§„èŒƒæ˜¯ Commonjsï¼ˆæœåŠ¡ç«¯ï¼‰ä¸ ESM</li></ul><h3 id="commonjs" tabindex="-1"><a class="header-anchor" href="#commonjs"><span>CommonJS</span></a></h3><ul><li>Common JS è§„èŒƒèµ·åˆæ˜¯ä¸ºäº†å¼¥è¡¥ JSè¯­è¨€æ¨¡å—åŒ–ç¼ºé™·</li><li>Common JSæ˜¯è¯­è¨€å±‚é¢çš„è§„èŒƒï¼Œå½“å‰ä¸»è¦ç”¨äº Node.js</li><li>CommonJS è§„å®šæ¨¡å—åŒ–åˆ†ä¸ºå¼•å…¥ã€å®šä¹‰ã€æ ‡è¯†ç¬¦ä¸‰ä¸ªéƒ¨åˆ†</li><li>Moudle åœ¨ä»»æ„æ¨¡å—ä¸­å¯ç›´æ¥ä½¿ç”¨åŒ…å«æ¨¡å—ä¿¡æ¯</li><li>Require æ¥æ”¶æ ‡è¯†ç¬¦ï¼ŒåŠ è½½ç›®æ ‡æ¨¡å—</li><li>Exports ä¸ module.exports éƒ½èƒ½å¯¼å‡ºæ¨¡å—æ•°æ®</li><li>CommonJSè§„èŒƒå®šä¹‰æ¨¡å—çš„åŠ è½½æ˜¯åŒæ­¥å®Œæˆ</li></ul><p><strong>æ¨¡å—å¼•ç”¨</strong></p><ul><li>ä½¿ç”¨ require å¯¼å…¥å…¶å®ƒæ¨¡å—</li></ul><p><strong>æ¨¡å—å®šä¹‰</strong></p><ul><li>ä»»æ„ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå…·æœ‰ç‹¬ç«‹ä½œç”¨åŸŸ</li></ul><p><strong>æ¨¡å—æ ‡è¯†</strong></p><ul><li>å°†æ¨¡å— ID ä¼ å…¥ require å®ç°ç›®æ ‡æ¨¡å—å®šä½</li></ul><p><strong>module å±æ€§</strong></p><ul><li>ä»»æ„ is æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ module å±æ€§</li><li>idï¼šè¿”å›æ¨¡å—æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„</li><li>filename: è¿”å›æ–‡ä»¶æ¨¡å—çš„ç»å¯¹è·¯å¾„</li><li>loaded: è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ¨¡å—æ˜¯å¦å®ŒæˆåŠ è½½</li><li>parent: è¿”å›å¯¹è±¡å­˜æ”¾è°ƒç”¨å½“å‰æ¨¡å—çš„æ¨¡å—</li><li>children: è¿”å›æ•°ç»„ï¼Œå­˜æ”¾å½“å‰æ¨¡å—è°ƒç”¨çš„å…¶å®ƒæ¨¡å—</li><li>exportsï¼šè¿”å›å½“å‰æ¨¡å—éœ€è¦æš´éœ²çš„å†…å®¹</li><li>pathsï¼šè¿”å›æ•°ç»„ï¼Œå­˜æ”¾ä¸åŒç›®å½•ä¸‹çš„ node_modules ä½ç½®</li></ul><p><strong>module.exports ä¸ exports æœ‰ä½•åŒºåˆ«ï¼Ÿ</strong></p><ul><li><code>exports</code> å¯¹è±¡æ˜¯ <code>module</code> å¯¹è±¡çš„ä¸€ä¸ªå±æ€§,åœ¨åˆå§‹æ—¶ <code>module.exports</code> å’Œ <code>exports</code> æŒ‡å‘åŒä¸€å—å†…å­˜åŒºåŸŸ</li><li>æ¨¡å—å¯¼å‡ºçš„æ˜¯ <code>module.exports</code> , <code>exports</code> åªæ˜¯å¯¹å®ƒçš„å¼•ç”¨,åœ¨ä¸æ”¹å˜<code>exports</code> å†…å­˜çš„æƒ…å†µä¸‹,ä¿®æ”¹<code>exports</code> çš„å€¼å¯ä»¥æ”¹å˜ <code>module.exports</code> çš„å€¼</li><li>å¯¼å‡ºæ—¶å°½é‡ä½¿ç”¨ <code>module.exports</code> ,ä»¥å…å› ä¸ºå„ç§èµ‹å€¼å¯¼è‡´çš„æ··ä¹±</li></ul><p><strong>require å±æ€§</strong></p><ul><li>åŸºæœ¬åŠŸèƒ½æ˜¯è¯»å…¥å¹¶ä¸”æ‰§è¡Œä¸€ä¸ªæ¨¡å—æ–‡ä»¶</li><li>resolve:è¿”å›æ¨¡å—æ–‡ä»¶ç»å¯¹è·¯å¾„</li><li>extensions:ä¾æ®ä¸åŒåç¼€åæ‰§è¡Œè§£ææ“ä½œ</li><li>main:è¿”å›ä¸»æ¨¡å—å¯¹è±¡</li></ul><h3 id="nodejs-ä¸-commonjs" tabindex="-1"><a class="header-anchor" href="#nodejs-ä¸-commonjs"><span>Nodejs ä¸ CommonJs</span></a></h3><ul><li><p>ä½¿ç”¨ module.exports ä¸ require å®ç°æ¨¡å—å¯¼å…¥ä¸å¯¼å‡º</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// å¯¼å‡º</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">addFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">,</span>
  addFn
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// å¯¼å…¥</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./export&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">addFn</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>moduleå±æ€§åŠå…¶å¸¸è§ä¿¡æ¯è·å–</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>exports å¯¼å‡ºæ•°æ®åŠå…¶ä¸ module.exports åŒºåˆ«</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// å¯¼å‡º</span>
exports<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">// å¯¼å…¥</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./export&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// GodX------&gt;log { age: 10 }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>CommonJS è§„èŒƒä¸‹çš„æ¨¡å—åŒæ­¥åŠ è½½</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// å¯¼å‡º</span>
<span class="token keyword">let</span> iTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> iTime <span class="token operator">&lt;</span> <span class="token number">4000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
exports<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;åŠ è½½å¯¼å…¥äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¯¼å…¥</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./export&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å¯¼å‡ºçš„ä»£ç æ‹¿åˆ°äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹æ˜¯å¦æ˜¯ä¸»æ¨¡å—ï¼Œç”¨äºä»£ç è°ƒè¯•</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// å¯¼å‡º</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span>main <span class="token operator">===</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token comment">// å¯¼å…¥</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./export&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span>main <span class="token operator">===</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="æ¨¡å—åˆ†ç±»åŠåŠ è½½æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—åˆ†ç±»åŠåŠ è½½æµç¨‹"><span>æ¨¡å—åˆ†ç±»åŠåŠ è½½æµç¨‹</span></a></h3><p><strong>æ¨¡å—åˆ†ç±»</strong></p><ul><li>å†…ç½®æ¨¡å—ï¼šNode æºç ç¼–è¯‘æ—¶å†™å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­</li><li>æ–‡ä»¶æ¨¡å—ï¼šä»£ç è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åŠ è½½ï¼Œç›¸å¯¹äºå†…ç½®æ¨¡å—è¾ƒæ…¢</li></ul><p><strong>åŠ è½½æµç¨‹</strong></p><ul><li>è·¯å¾„åˆ†æï¼šä¾æ®æ ‡è¯†ç¬¦å·ç¡®å®šæ¨¡å—ä½ç½®</li><li>æ–‡ä»¶å®šä½ï¼šç¡®å®šç›®æ ‡ä¸­å…·ä½“çš„æ–‡ä»¶åŠæ–‡ä»¶ç±»å‹</li><li>ç¼–è¯‘æ‰§è¡Œï¼šé‡‡ç”¨å¯¹åº”çš„æ–¹å¼å®Œæˆæ–‡ä»¶çš„ç¼–è¯‘æ‰§è¡Œ</li></ul><p><strong>è·¯å¾„åˆ†æä¹‹æ ‡è¯†ç¬¦</strong></p><ul><li>è·¯å¾„æ ‡è¯†ç¬¦</li><li>éè·¯å¾„æ ‡è¯†ç¬¦ï¼šæ¯”å¦‚ pathã€fsç­‰æ ¸å¿ƒæ¨¡å—</li></ul><p><strong>æ–‡ä»¶å®šä½çš„æµç¨‹</strong></p><ul><li>é¡¹ç›®ä¸‹å­˜åœ¨ <code>m1.js</code>æ¨¡å—ï¼Œå¯¼å…¥æ—¶ä½¿ç”¨ <code>require(&#39;m1&#39;)</code>è¯­æ³•</li><li><code>m1.js</code> â€“&gt; <code>m1.json</code> â€”&gt; <code>m1.node</code>ï¼ˆè¡¥è¶³æ‰©å±•åä¾æ­¤å»æŸ¥æ‰¾ï¼‰</li><li>å¦‚æœä»¥ä¸Šæ“ä½œè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šå½“åšä¸€ä¸ªåŒ…ï¼ˆç›®å½•ï¼‰å¤„ç†ï¼Œå»æŸ¥æ‰¾ <code>package.json</code>æ–‡ä»¶ï¼Œä½¿ç”¨ <code>JSON.parse()</code>è§£æï¼Œå–å‡ºæè¿°æ–‡ä»¶ä¸­çš„ main å±æ€§å€¼</li><li>å¦‚æœ main å±æ€§å€¼æ²¡æœ‰æ‰©å±•åï¼Œ<code>main.js</code> â€“&gt; <code>main.json</code> â€”&gt; <code>main.node</code>ï¼ˆè¡¥è¶³æ‰©å±•åä¾æ­¤å»æŸ¥æ‰¾ï¼‰</li><li>ä»¥ä¸Šæ“ä½œè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œé»˜è®¤ä¼šå°† index åšä¸ºç›®æ ‡æ¨¡å—ä¸­çš„å…·ä½“æ–‡ä»¶åç§°</li><li>æœ€ç»ˆè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šæŠ¥é”™</li></ul><p><strong>ç¼–è¯‘æ‰§è¡Œ</strong></p><ul><li>ä½¿ç”¨ fsæ¨¡å—åŒæ­¥è¯»å…¥ç›®æ ‡æ–‡ä»¶å†…å®¹</li><li>å¯¹å†…å®¹è¿›è¡Œè¯­æ³•åŒ…è£…ï¼Œç”Ÿæˆå¯æ‰§è¡Œ JS å‡½æ•°</li><li>è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥ exportsã€moduleã€ require ç­‰å±æ€§å€¼</li></ul><p><strong>JSON æ–‡ä»¶ç¼–è¯‘æ‰§è¡Œ</strong></p><ul><li>å°†è¯»å–åˆ°çš„å†…å®¹é€šè¿‡ JSON.parse() è¿›è¡Œè§£æ</li></ul><p><strong>ç¼“å­˜ä¼˜åŒ–åŸåˆ™</strong></p><ul><li>æé«˜æ¨¡å—åŠ è½½é€Ÿåº¦</li><li>å½“å‰æ¨¡å—ä¸å­˜åœ¨ï¼Œåˆ™ç»å†ä¸€æ¬¡å®Œæ•´çš„åŠ è½½æµç¨‹</li><li>æ¨¡å—åŠ è½½å®Œæˆåï¼Œä½¿ç”¨è·¯å¾„åšä¸ºç´¢å¼•è¿›è¡Œç¼“å­˜</li></ul><p><strong>åŠ è½½æµç¨‹å°ç»“</strong></p><ul><li>è·¯å¾„åˆ†æï¼šç¡®å®šç›®æ ‡æ¨¡å—ä½ç½®</li><li>æ–‡ä»¶å®šä½ï¼šç¡®å®šç›®æ ‡æ¨¡å—ä¸­çš„å…·ä½“æ–‡ä»¶</li><li>ç¼–è¯‘æ‰§è¡Œï¼šå¯¹æ¨¡å—å†…å®¹è¿›è¡Œç¼–è¯‘ï¼Œè¿”å›å¯ç”¨çš„ <code>exports</code> å¯¹è±¡</li></ul><h3 id="å†…ç½®æ¨¡å—ä¹‹-vm" tabindex="-1"><a class="header-anchor" href="#å†…ç½®æ¨¡å—ä¹‹-vm"><span>å†…ç½®æ¨¡å—ä¹‹ VM</span></a></h3><p>åˆ›å»ºç‹¬ç«‹è¿è¡Œçš„æ²™ç®±ç¯å¢ƒ</p><p><strong>JS ä¸­å¦‚ä½•è¿è¡Œå­—ç¬¦ä¸²ä»£ç </strong></p><ul><li>eval</li><li>new Function</li><li>vm</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//* eval</span>
<span class="token comment">// eval(content);</span>
<span class="token comment">// console.log(&#39;GodX------&gt;log&#39;,a);</span>

<span class="token comment">//* new Function</span>
<span class="token comment">// let a = 1;</span>
<span class="token comment">// let fn = new Function(&quot;a&quot;, &quot;return a + 10&quot;);</span>
<span class="token comment">// console.log(&quot;GodX------&gt;log&quot;, fn(a));</span>

<span class="token comment">//* vm</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>
vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>a <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// runInThisContextåˆ›å»ºçš„æ²™ç®±ç¯å¢ƒä¸å¤–éƒ¨éš”ç¦»,ä½†æ˜¯å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„å…¨å±€å˜é‡</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 109</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¬¬ä¸‰æ–¹æ¨¡å—åŠ è½½æ¨¡æ‹Ÿå®ç°" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ–¹æ¨¡å—åŠ è½½æ¨¡æ‹Ÿå®ç°"><span>ç¬¬ä¸‰æ–¹æ¨¡å—åŠ è½½æ¨¡æ‹Ÿå®ç°</span></a></h3><p><strong>æ ¸å¿ƒé€»è¾‘</strong></p><ul><li>è·¯å¾„åˆ†æ</li><li>ç¼“å­˜ä¼˜åŒ–</li><li>æ–‡ä»¶å®šä½</li><li>ç¼–è¯‘æ‰§è¡Œ</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Module</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//? è·¯å¾„åˆ†æ</span>
Module<span class="token punctuation">.</span><span class="token function-variable function">_resolveFilename</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> absPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>absPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> absPath<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> suffix <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> suffix<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> newPath <span class="token operator">=</span> absPath <span class="token operator">+</span> suffix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newPath<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not exist!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//? ç¼–è¯‘æ‰§è¡Œ</span>
<span class="token class-name">Module</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> extname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">[</span>extname<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Module<span class="token punctuation">.</span>_extensions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;.js&quot;</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//* è¯»å–</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//* åŒ…è£…</span>
    content <span class="token operator">=</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> content <span class="token operator">+</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//* VM</span>
    <span class="token keyword">let</span> compileFn <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//* å‡†å¤‡å‚æ•°çš„å€¼</span>
    <span class="token keyword">let</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token keyword">let</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> filename <span class="token operator">=</span> module<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

    <span class="token comment">//* è°ƒç”¨</span>
    <span class="token function">compileFn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> myRequire<span class="token punctuation">,</span> module<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;.json&quot;</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> content<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Module<span class="token punctuation">.</span>wrapper <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;(function (exports,require,module,__filename,__dirname) {&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;})&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

Module<span class="token punctuation">.</span>_cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myRequire</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//*1 è·å–ç»å¯¹è·¯å¾„</span>
  <span class="token keyword">const</span> mPath <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">_resolveFilename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//*2 ç¼“å­˜ä¼˜å…ˆ</span>
  <span class="token keyword">let</span> cacheModule <span class="token operator">=</span> Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>mPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheModule<span class="token punctuation">)</span> <span class="token keyword">return</span> cacheModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>

  <span class="token comment">//*3 åˆ›å»ºç©ºå¯¹è±¡åŠ è½½ç›®æ ‡æ¨¡å—</span>
  <span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>mPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//*4 ç¼“å­˜å·²ç»åŠ è½½è¿‡çš„æ¨¡å—</span>
  Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>mPath<span class="token punctuation">]</span> <span class="token operator">=</span> module<span class="token punctuation">;</span>

  <span class="token comment">//*5 æ‰§è¡ŒåŠ è½½ï¼ˆç¼–è¯‘æ‰§è¡Œï¼‰</span>
  module<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//*6 è¿”å›æ•°æ®</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">myRequire</span><span class="token punctuation">(</span><span class="token string">&quot;./v&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>å¯¹äº JavaScript æ¨¡å—ï¼ŒåŠ è½½å™¨å‡½æ•°ä¼šé¦–å…ˆè¯»å–æ¨¡å—çš„å†…å®¹ï¼Œç„¶ååœ¨æ¨¡å—å†…å®¹çš„å‰åæ·»åŠ ä¸€äº›åŒ…è£…ä»£ç ï¼Œæœ€åä½¿ç”¨ <code>vm.runInThisContext</code> æ–¹æ³•åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ç¼–è¯‘è¿™ä¸ªæ¨¡å—ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ï¼Ÿ</strong></p><p>åœ¨åŠ è½½ JavaScript æ¨¡å—æ—¶ï¼Œéœ€è¦ä¸ºæ¨¡å—å†…å®¹æ·»åŠ ä¸€äº›åŒ…è£…ä»£ç ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ¨¡å—çš„ä½œç”¨åŸŸï¼ˆscopeï¼‰æ­£ç¡®ï¼Œå¹¶é˜²æ­¢æ¨¡å—å†…å®¹ä¸å…¶ä»–æ¨¡å—çš„å†…å®¹å‘ç”Ÿå‘½åå†²çªã€‚</p><p>æ¨¡å—çš„ä»£ç åŒ…è£…æ˜¯ä½¿ç”¨ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°æ¥å®ç°çš„ï¼Œè¿™ä¸ªè‡ªæ‰§è¡Œå‡½æ•°æœ‰ä¸€ä¸ª <code>exports</code> å‚æ•°ï¼Œç”¨äºå­˜å‚¨æ¨¡å—çš„å¯¼å‡ºå€¼ã€‚åœ¨æ‰§è¡Œè‡ªæ‰§è¡Œå‡½æ•°æ—¶ï¼Œå°†å½“å‰æ¨¡å—çš„ <code>exports</code> å¯¹è±¡ã€<code>require</code> å‡½æ•°ã€<code>module</code> å¯¹è±¡ã€<code>__filename</code> å’Œ <code>__dirname</code> ç­‰å‚æ•°ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªå‡½æ•°ã€‚è¿™æ ·ï¼Œæ¨¡å—ä¸­çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½ä¼šåœ¨è¿™ä¸ªè‡ªæ‰§è¡Œå‡½æ•°çš„ä½œç”¨åŸŸä¸­å®šä¹‰ï¼Œä¸ä¼šå¯¹å…¶ä»–æ¨¡å—æˆ–å…¨å±€ä½œç”¨åŸŸé€ æˆå½±å“ã€‚</p><p>å› æ­¤ï¼ŒåŒ…è£…æ˜¯ç¡®ä¿æ¨¡å—çš„ä½œç”¨åŸŸæ­£ç¡®ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„é‡è¦æ‰‹æ®µã€‚</p></div><h2 id="events-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#events-æ¨¡å—"><span>Events æ¨¡å—</span></a></h2><p>é€šè¿‡ EventEmitter ç±»å®ç°äº‹ä»¶ç»Ÿä¸€ç®¡ç†</p><h3 id="events-ä¸-eventemitter" tabindex="-1"><a class="header-anchor" href="#events-ä¸-eventemitter"><span>Events ä¸ EventEmitter</span></a></h3><ul><li>node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ“ä½œæ¶æ„ï¼Œå†…ç½® events æ¨¡å—</li><li>events æ¨¡å—æä¾›äº† EventEmitter ç±»</li><li>Node.js ä¸­çš„å¾ˆå¤šå†…ç½®æ ¸å¿ƒæ¨¡å—ç»§æ‰¿ EventEmitter</li></ul><h3 id="eventemitter-å¸¸è§-api" tabindex="-1"><a class="header-anchor" href="#eventemitter-å¸¸è§-api"><span>EventEmitter å¸¸è§ API</span></a></h3><ul><li>onï¼šæ·»åŠ å½“äº‹ä»¶è¢«è§¦å‘æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°</li><li>emitï¼šè§¦å‘äº‹ä»¶ï¼ŒæŒ‰ç…§æ³¨å†Œçš„åºåŒæ­¥è°ƒç”¨æ¯ä¸ªäº‹ä»¶ç›‘å¬å™¨</li><li>onceï¼šæ·»åŠ å½“äº‹ä»¶åœ¨æ³¨å†Œä¹‹åé¦–æ¬¡è¢«è§¦å‘æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°</li><li>offï¼šç§»é™¤ç‰¹å®šçš„ç›‘å¬å™¨</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ³¨å†Œäº‹ä»¶</span>
ev<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ev<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è®¢é˜…</span>
ev<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å†…ç½®æ¨¡å—ç»§æ‰¿</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> crt <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

crt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‘å¸ƒè®¢é˜…æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒè®¢é˜…æ¨¡å¼"><span>å‘å¸ƒè®¢é˜…æ¨¡å¼</span></a></h3><p>å®šä¹‰å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</p><p>å‘å¸ƒè®¢é˜…å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230524135534469.png" alt="image-20230524135534469" tabindex="0" loading="lazy"><figcaption>image-20230524135534469</figcaption></figure><p><strong>è¦ç´ </strong></p><ul><li>ç¼“å­˜é˜Ÿåˆ—ï¼Œå­˜æ”¾è®¢é˜…è€…ä¿¡æ¯</li><li>å…·æœ‰å¢åŠ ã€åˆ é™¤è®¢é˜…çš„èƒ½åŠ›</li><li>çŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰è®¢é˜…ç€æ‰§è¡Œç›‘å¬</li></ul><p><strong>ä¸è§‚å¯Ÿè€…æ¨¡å¼çš„åŒºåˆ«</strong></p><ul><li>å‘å¸ƒè®¢é˜…ä¸­å­˜åœ¨è°ƒåº¦ä¸­å¿ƒ</li><li>çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å¸ƒè®¢é˜…æ— é¡»ä¸»åŠ¨é€šçŸ¥</li></ul><p><strong>ä»£ç å®ç°</strong></p><div class="vp-code-tabs"><div class="vp-code-tabs-nav" role="tablist"><button type="button" class="vp-code-tab-nav active" role="tab" aria-controls="codetab-1198-0" aria-selected="true">EventEmitter</button><button type="button" class="vp-code-tab-nav" role="tab" aria-controls="codetab-1198-1" aria-selected="false">ä½¿ç”¨</button></div><!--[--><div class="vp-code-tab active" id="codetab-1198-0" role="tabpanel" aria-expanded="true"><div class="vp-code-tab-title">EventEmitter</div><!--[--><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// { &#39;click&#39;: [fn1, fn2], &#39;change&#39;: [fn] }</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ³¨å†Œäº‹ä»¶</span>
  <span class="token function">$on</span><span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¿è¯äº‹ä»¶çš„ç±»å‹æ˜¯æ•°ç»„ç±»å‹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// å­˜å‚¨äº‹ä»¶åˆ°äº‹ä»¶ä¸­å¿ƒ</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
    <span class="token function">$off</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item <span class="token operator">!==</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">$once</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">wrapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">listener</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è§¦å‘äº‹ä»¶</span>
 <span class="token function">$emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> eventList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventList <span class="token operator">&amp;&amp;</span> eventList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      eventList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="vp-code-tab" id="codetab-1198-1" role="tabpanel" aria-expanded="false"><div class="vp-code-tab-title">ä½¿ç”¨</div><!--[--><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">let</span> em <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
em<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;click1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
em<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;click2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

em<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h2 id="æµè§ˆå™¨ä¸­çš„-eventloop" tabindex="-1"><a class="header-anchor" href="#æµè§ˆå™¨ä¸­çš„-eventloop"><span>æµè§ˆå™¨ä¸­çš„ EventLoop</span></a></h2><p><strong>å®Œæ•´äº‹ä»¶ç¯æ‰§è¡Œé¡ºåº</strong></p><ol><li>ä»ä¸Šè‡³ä¸‹æ‰§è¡Œæ‰€æœ‰çš„åŒæ­¥ä»£ç </li><li>æ‰§è¡Œè¿‡ç¨‹ä¸­å°†é‡åˆ°çš„å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡æ·»åŠ è‡³ç›¸åº”çš„é˜Ÿåˆ—</li><li>åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œæ‰§è¡Œæ»¡è¶³æ¡ä»¶çš„å¾®ä»»åŠ¡å›è°ƒ</li><li>å¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œæ‰€æœ‰æ»¡è¶³éœ€æ±‚çš„å®ä»»åŠ¡å›è°ƒ</li><li>å¾ªç¯äº‹ä»¶ç¯æ“ä½œ</li></ol><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡ä¹‹åå°±ä¼šç«‹åˆ»æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—</p></div><h2 id="nodejs-ä¸‹çš„äº‹ä»¶å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#nodejs-ä¸‹çš„äº‹ä»¶å¾ªç¯"><span>Nodejs ä¸‹çš„äº‹ä»¶å¾ªç¯</span></a></h2><p>æµè§ˆå™¨ä¸­æœ‰ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼š</p><ul><li>å®ä»»åŠ¡</li><li>å¾®ä»»åŠ¡</li></ul><p>è€Œ Nodejs ä¸­æœ‰ 6 ä¸ªï¼š</p><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230529153319630.png" alt="image-20230529153319630" tabindex="0" loading="lazy"><figcaption>image-20230529153319630</figcaption></figure><ul><li>timersï¼šæ‰§è¡Œ setTimout ä¸ setinterval å›è°ƒ</li><li>pending callbacksï¼šæ‰§è¡Œç³»ç»Ÿæ“ä½œçš„å›è°ƒï¼Œä¾‹å¦‚ tcp udp</li><li>idle, prepareï¼šåªåœ¨ç³»ç»Ÿå†…éƒ¨è¿›è¡Œä½¿ç”¨</li><li>pollï¼šæ‰§è¡Œä¸ I/O ç›¸å…³çš„å›è°ƒï¼Œæ¯”å¦‚æ–‡ä»¶çš„è¯»å–ç­‰</li><li>checkï¼šæ‰§è¡Œ setlmmediate ä¸­çš„å›è°ƒ</li><li>close callbacksï¼š æ‰§è¡Œ close äº‹ä»¶çš„å›è°ƒ</li></ul><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p><ul><li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå°†ä¸åŒçš„ä»»åŠ¡æ·»åŠ è‡³ç›¸åº”çš„é˜Ÿåˆ—</li><li>æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œåä¼šå»æ‰§è¡Œæ»¡è¶³æ¡ä»¶å¾®ä»»åŠ¡</li><li>æ‰€æœ‰å¾®ä»»åŠ¡ä»£ç æ‰§è¡Œåä¼šæ‰§è¡Œ timer é˜Ÿåˆ—ä¸­æ»¡è¶³çš„å®ä»»åŠ¡</li><li>timer ä¸­çš„æ‰€æœ‰å®ä»»åŠ¡æ‰§è¡Œå®Œæˆåå°±ä¼šä¾æ¬¡åˆ‡æ¢é˜Ÿåˆ—</li></ul><div class="hint-container tip"><p class="hint-container-title">æ³¨æ„</p><ul><li>åœ¨å®Œæˆé˜Ÿåˆ—åˆ‡æ¢ä¹‹å‰ä¼šå…ˆæ¸…ç©ºå¾®ä»»åŠ¡ä»£ç </li></ul></div><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230529160823912.png" alt="image-20230529160823912" tabindex="0" loading="lazy"><figcaption>image-20230529160823912</figcaption></figure><p>Nodejs ä¸­ nextTick çš„ä¼˜å…ˆçº§æ¯” promise.then è¦é«˜</p><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>Node.js ä» v11.0.0 å¼€å§‹ï¼Œä¸ºäº†ä¸æµè§ˆå™¨ä¿æŒä¸€è‡´ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡ä¹‹åå°±ä¼šç«‹åˆ»æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—</p><p>åœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¾ªç¯çš„é¡ºåºæ˜¯ï¼štimers -&gt; I/O callbacks -&gt; idle, prepare -&gt; poll -&gt; check -&gt; close callbacks -&gt; process.nextTick</p></div><p><strong>ç¤ºä¾‹</strong></p><div class="vp-code-tabs"><div class="vp-code-tabs-nav" role="tablist"><button type="button" class="vp-code-tab-nav active" role="tab" aria-controls="codetab-1351-0" aria-selected="true">JS</button><button type="button" class="vp-code-tab-nav" role="tab" aria-controls="codetab-1351-1" aria-selected="false">ç»“æœ</button></div><!--[--><div class="vp-code-tab active" id="codetab-1351-0" role="tabpanel" aria-expanded="true"><div class="vp-code-tab-title">JS</div><!--[--><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;p1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;p2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;p3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="vp-code-tab" id="codetab-1351-1" role="tabpanel" aria-expanded="false"><div class="vp-code-tab-title">ç»“æœ</div><!--[--><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// v11 ä»¥å‰</span>
startã€endã€p2ã€s1ã€s2ã€t1ã€t2ã€p1ã€p3
<span class="token comment">// v11 ä»¥å</span>
startã€endã€p2ã€s1ã€t1ã€p1ã€s2ã€t2ã€p3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h2 id="nodejs-ä¸æµè§ˆå™¨äº‹ä»¶ç¯çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#nodejs-ä¸æµè§ˆå™¨äº‹ä»¶ç¯çš„åŒºåˆ«"><span>Nodejs ä¸æµè§ˆå™¨äº‹ä»¶ç¯çš„åŒºåˆ«</span></a></h2><ul><li>ä»»åŠ¡é˜Ÿåˆ—æ•°ä¸åŒ <ul><li>æµè§ˆå™¨ä¸­åªæœ‰ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—</li><li>Nodejs ä¸­æœ‰ 6 ä¸ªäº‹ä»¶é˜Ÿåˆ—</li></ul></li><li>Nodejs å¾®ä»»åŠ¡æ‰§è¡Œæ—¶æœºä¸åŒ <ul><li>äºŒè€…éƒ½ä¼šåœ¨åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œå¾®ä»»åŠ¡</li><li>æµè§ˆå™¨å¹³å°ä¸‹æ¯å½“ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå°±æ¸…ç©ºå¾®ä»»åŠ¡</li><li>Nodejs å¹³å°åœ¨äº‹ä»¶é˜Ÿåˆ—åˆ‡æ¢æ—¶å›å»æ¸…ç©ºå¾®ä»»åŠ¡</li></ul></li><li>å¾®ä»»åŠ¡ä¼˜å…ˆçº§ä¸åŒ <ul><li>æµè§ˆå™¨äº‹ä»¶ç¯ä¸­ï¼Œå¾®ä»»åŠ¡å­˜æ”¾äºäº‹ä»¶é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡º</li><li>Nodejs ä¸­ process.nextTick å…ˆäº promise.then</li></ul></li></ul><h2 id="nodejs-äº‹ä»¶ç¯å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#nodejs-äº‹ä»¶ç¯å¸¸è§é—®é¢˜"><span>Nodejs äº‹ä»¶ç¯å¸¸è§é—®é¢˜</span></a></h2><p><strong>setTimeout å’Œ setImmdiate çš„æ‰§è¡Œé¡ºåº</strong></p><ul><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒsetTimeout å’Œ setImmdiate çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ã€‚å› ä¸º setTimeout çš„å»¶æ—¶æ—¶é—´æ˜¯ä¸å›ºå®šçš„</p></li><li><p>å¦‚æœå°† setTimeout å’Œ setImmdiate æ”¾åˆ°å›è°ƒå½“ä¸­ï¼Œé‚£ä¹ˆé¡ºåºå°†ä¼šæ˜¯å›ºå®šçš„ï¼Œå› ä¸ºåœ¨ Node.js ä¸­ï¼Œäº‹ä»¶å¾ªç¯çš„é¡ºåºæ˜¯ï¼štimers -&gt; I/O callbacks -&gt; pollï¼ŒI / O æ“ä½œä¹‹åï¼Œä¼šå¾€ä¸‹å»æ‰§è¡Œ pollé˜Ÿåˆ—ï¼ˆsetImmidateï¼‰,ç„¶åè¿›å…¥ä¸‹ä¸€æ¬¡äº‹ä»¶ç¯</p></li></ul><h2 id="stream" tabindex="-1"><a class="header-anchor" href="#stream"><span>Stream</span></a></h2><ul><li>Node.js è¯ç”Ÿä¹‹åˆå°±æ˜¯ä¸ºäº†æé«˜ IO æ€§èƒ½ï¼Œè§£å†³å¯†é›†å‹ IO äº‹åŠ¡ï¼ˆæ–‡ä»¶ã€ç½‘ç»œç­‰ï¼‰</li><li>æ–‡ä»¶æ“ä½œç³»ç»Ÿå’Œç½‘ç»œæ¨¡å—å®ç°äº†æµæ¥å£</li><li>Nodejs ä¸­çš„æµå°±æ˜¯å¤„ç†æµå¼æ•°æ®çš„æŠ½è±¡æ¥å£</li><li>Node.js ä¸­ stream æ˜¯æµæ“ä½œçš„æŠ½è±¡æ¥å£é›†åˆ</li><li>å¯è¯»ã€å¯å†™ã€åŒå·¥ã€è½¬æ¢æ˜¯å•ä¸€æŠ½è±¡å…·ä½“å®ç°</li><li>æµæ“ä½œçš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯å¤„ç†æ•°æ®</li><li>Node.js ä¸­å¤„ç†æ•°æ®æ¨¡å—ç»§æ‰¿äº†æµå’Œ EventEmitter</li></ul><h3 id="åº”ç”¨ç¨‹åºä¸­ä¸ºä»€ä¹ˆä½¿ç”¨æµæ¥å¤„ç†æ•°æ®" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨ç¨‹åºä¸­ä¸ºä»€ä¹ˆä½¿ç”¨æµæ¥å¤„ç†æ•°æ®"><span>åº”ç”¨ç¨‹åºä¸­ä¸ºä»€ä¹ˆä½¿ç”¨æµæ¥å¤„ç†æ•°æ®ï¼Ÿ</span></a></h3><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613163514085.png" alt="image-20230613163514085" tabindex="0" loading="lazy"><figcaption>image-20230613163514085</figcaption></figure><p><strong>å¸¸è§é—®é¢˜</strong></p><ul><li>åŒæ­¥è¯»å–èµ„æºæ–‡ä»¶ï¼Œç”¨æˆ·éœ€è¦ç­‰å¾…æ•°æ®è¯»å–å®Œæˆ</li><li>èµ„æºæ–‡ä»¶æœ€ç»ˆä¸€æ¬¡æ€§åŠ è½½è‡³å†…å­˜ï¼Œå¼€é”€è¾ƒå¤§</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613163732948.png" alt="image-20230613163732948" tabindex="0" loading="lazy"><figcaption>image-20230613163732948</figcaption></figure><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613163831814.png" alt="image-20230613163831814" tabindex="0" loading="lazy"><figcaption>image-20230613163831814</figcaption></figure><p><strong>æ€»ç»“</strong></p><ul><li>æ—¶é—´æ•ˆç‡ï¼šæµçš„åˆ†æ®µå¤„ç†å¯ä»¥åŒæ—¶æ“ä½œå¤šä¸ªæ•°æ® chunk</li><li>ç©ºé—´æ•ˆç‡ï¼šåŒä¸€æ—¶é—´æµæ— éœ€å æ®å¤§å†…å­˜ç©ºé—´</li><li>ä½¿ç”¨æ–¹ä¾¿ï¼šæµé…åˆç®¡é“åŠ å·¥ç®¡ç†ï¼Œæ‰©å±•ç¨‹åºå˜å¾—ç®€å•</li></ul><h3 id="nodejs-ä¸­æµçš„åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#nodejs-ä¸­æµçš„åˆ†ç±»"><span>Nodejs ä¸­æµçš„åˆ†ç±»</span></a></h3><p>Nodejs å†…ç½®äº† streamï¼Œå®ƒå®ç°äº†æµæ“ä½œå¯¹è±¡</p><ul><li>Readable: å¯è¯»æµï¼Œèƒ½å¤Ÿå®ç°æ•°æ®çš„è¯»å–</li><li>Writable: å¯å†™æµï¼Œèƒ½å¤Ÿå®ç°æ•°æ®çš„å†™æ“ä½œ</li><li>Duplexï¼šåŒå·¥æµï¼Œæ—¢å¯è¯»åˆå¯å†™</li><li>Tranformï¼šè½¬æ¢æµï¼Œå¯è¯»å¯å†™ï¼Œè¿˜èƒ½å®ç°æ•°æ®è½¬æ¢</li></ul><h3 id="nodejs-æµç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#nodejs-æµç‰¹ç‚¹"><span>Nodejs æµç‰¹ç‚¹</span></a></h3><ul><li>Stream æ¨¡å—å®ç°äº†å››ä¸ªå…·ä½“çš„æŠ½è±¡</li><li>æ‰€æœ‰çš„æµéƒ½ç»§æ‰¿è‡ª EventEmitter</li></ul><h3 id="åˆä½“éªŒ" tabindex="-1"><a class="header-anchor" href="#åˆä½“éªŒ"><span>åˆä½“éªŒ</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./test1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å°† test.txt æ–‡ä»¶æ‹·è´è‡³ test1.txt æ–‡ä»¶ä¸‹ï¼Œæ²¡æœ‰åˆ™ä¼šåˆ›å»º</span>
rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ"><span>å¯è¯»æµ</span></a></h3><p>ç”Ÿäº§ä¾›ç¨‹åºæ¶ˆè´¹æ•°æ®çš„æµ</p><p><strong>å¦‚ä½•è‡ªå®šä¹‰å¯è¯»æµï¼Ÿ</strong></p><ul><li>ç»§æ‰¿ stream é‡Œçš„ Readable</li><li>é‡å†™ _read æ–¹æ³•è°ƒç”¨ push äº§å‡ºæ•°æ®</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613165751992.png" alt="image-20230613165751992" tabindex="0" loading="lazy"><figcaption>image-20230613165751992</figcaption></figure><p><strong>æ¶ˆè´¹æ•°æ®</strong></p><ul><li>Readable äº‹ä»¶ï¼šå½“æµä¸­å­˜åœ¨å¯è¯»å–æ•°æ®æ—¶è§¦å‘</li><li>Data äº‹ä»¶ï¼šå½“æµä¸­æ•°æ®å—ä¼ ç»™æ¶ˆè´¹è€…åè§¦å‘</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230613170854692.png" alt="image-20230613170854692" tabindex="0" loading="lazy"><figcaption>image-20230613170854692</figcaption></figure><p><strong>è‡ªå®šä¹‰å¯è¯»æµé—®é¢˜</strong></p><ul><li>åº•å±‚æ•°æ®è¯»å–å®Œæˆä¹‹åå¦‚ä½•å¤„ç†ï¼Ÿ <ul><li>è¿”å› null å€¼è¡¨ç¤ºå®Œæˆ</li></ul></li><li>æ¶ˆè´¹è€…å¦‚ä½•è·å–å¯è¯»æµä¸­çš„æ•°æ®ï¼Ÿ <ul><li>æä¾›ä¸¤ä¸ªäº‹ä»¶æ¥è·å– <ul><li>readable</li><li>Data</li></ul></li></ul></li><li>æ¶ˆè´¹æ•°æ®ä¸ºä»€ä¹ˆå­˜åœ¨ä¸¤ç§æ–¹å¼ <ul><li>ä¸ºäº†æ»¡è¶³ä¸åŒçš„æ•°æ®ä½¿ç”¨åœºæ™¯ <ul><li>è¯»å–ä¸€éƒ¨åˆ†æ•°æ®</li><li>æºæºä¸æ–­è¯»å–æ‰€æœ‰æ•°æ®</li></ul></li></ul></li></ul><p><strong>æ€»ç»“</strong></p><ul><li>æ˜ç¡®æ•°æ®ç”Ÿäº§ä¸æ¶ˆè´¹æµç¨‹</li><li>åˆ©ç”¨ API å®ç°è‡ªå®šä¹‰çš„å¯è¯»æµ</li><li>æ˜ç¡®æ•°æ®æ¶ˆè´¹çš„äº‹ä»¶ä½¿ç”¨</li></ul><h3 id="å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµ"><span>å¯å†™æµ</span></a></h3><p>ç”¨äºæ¶ˆè´¹æ•°æ®çš„æµ</p><p><strong>åŸºæœ¬ä½¿ç”¨</strong></p><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230626165601088.png" alt="image-20230626165601088" tabindex="0" loading="lazy"><figcaption>image-20230626165601088</figcaption></figure><h3 id="åŒå·¥æµ-duplex" tabindex="-1"><a class="header-anchor" href="#åŒå·¥æµ-duplex"><span>åŒå·¥æµï¼ˆDuplexï¼‰</span></a></h3><p>å³èƒ½ç”Ÿäº§åˆèƒ½æ¶ˆè´¹çš„æµå«åšåŒå·¥æµ</p><p><strong>è‡ªå®šä¹‰åŒå·¥æµ</strong></p><ul><li>ç»§æ‰¿ Duplex ç±»</li><li>é‡å†™ _read æ–¹æ³•ï¼Œè°ƒç”¨ push ç”Ÿäº§æ•°æ®</li><li>é‡å†™ _write æ–¹æ³•ï¼Œè°ƒç”¨ write æ¶ˆè´¹æ•°æ®</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230801094230718.png" alt="image-20230801094230718" tabindex="0" loading="lazy"><figcaption>image-20230801094230718</figcaption></figure><h3 id="è½¬æ¢æµ-transform" tabindex="-1"><a class="header-anchor" href="#è½¬æ¢æµ-transform"><span>è½¬æ¢æµï¼ˆTransformï¼‰</span></a></h3><p>æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªåŒå·¥æµï¼Œä½†æ˜¯ä¸åŒå·¥æµä¹Ÿæœ‰ä¸€äº›åŒºåˆ«</p><ul><li>åŒå·¥æµä¸­è¯»å’Œå†™æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¯»å–çš„æ•°æ®ä¸èƒ½å¤Ÿè¢«å†™æ“ä½œç›´æ¥ä½¿ç”¨</li><li>åœ¨è½¬æ¢æµä¸­ï¼Œå°†è¯»å†™æ“ä½œè¿›è¡Œè”é€šï¼Œè¯»å–çš„æ•°æ®å¤Ÿè¢«å†™æ“ä½œç›´æ¥ä½¿ç”¨</li></ul><p><strong>è‡ªå®šä¹‰è½¬æ¢æµ</strong></p><ul><li>ç»§æ‰¿ Transform ç±»</li><li>é‡å†™ _transform æ–¹æ³•ï¼Œè°ƒç”¨ push å’Œ callback</li><li>é‡å†™ _flush æ–¹æ³•ï¼Œå¤„ç†å‰©ä½™æ•°æ®</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230801095136571.png" alt="image-20230801095136571" tabindex="0" loading="lazy"><figcaption>image-20230801095136571</figcaption></figure><h3 id="æ–‡ä»¶å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶å¯è¯»æµ"><span>æ–‡ä»¶å¯è¯»æµ</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// æ–‡ä»¶å¯è¯»æµ</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">fd</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token number">438</span><span class="token punctuation">,</span>
  <span class="token literal-property property">autoClose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">//   end: 3,</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token comment">// ç¼“å­˜åŒºçš„æœ€å¤§å­—èŠ‚æ•°</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµåŠ¨æ¨¡å¼</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æš‚åœ</span>
  rs<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç»§ç»­æ‰§è¡Œ</span>
    rs<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æºæºä¸æ–­è¯»å–æ‰€æœ‰æ•°æ®</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;readable&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–‡ä»¶è¢«æ‰“å¼€çš„å›è°ƒ</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// åªè¦è°ƒç”¨äº† createReadStream apiå°±ä¼šè§¦å‘</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæ–‡ä»¶æ‰“å¼€&quot;</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ•°æ®æ¶ˆè´¹å®Œæ¯•çš„å›è°ƒ</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ•°æ®æ¶ˆè´¹å®Œæ¯•è§¦å‘ï¼Œåœ¨closeä¹‹å‰è§¦å‘</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæ•°æ®æ¶ˆè´¹å®Œæ¯•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–‡ä»¶å…³é—­çš„å›è°ƒ</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ–‡ä»¶å…³é—­æ—¶è§¦å‘ï¼Œåœ¨endä¹‹åè§¦å‘</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæ–‡ä»¶å…³é—­äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é”™è¯¯å›è°ƒ</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// æŠ¥é”™æ—¶è§¦å‘ï¼Œåœ¨endä¹‹åè§¦å‘</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæ–‡ä»¶æŠ¥é”™&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¦‚ä½•åœ¨ end å›è°ƒä¸­æ¶ˆè´¹æ•°æ®</strong></p><p>æ–°å»ºä¸€ä¸ªå˜é‡ï¼Œåœ¨è¯»å–æ–‡ä»¶æ—¶å°†æ•°æ®å­˜å‚¨åˆ°å…¶ä¸­</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> bufferArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//* æµåŠ¨æ¨¡å¼</span>
rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  bufferArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>bufferArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ–‡ä»¶å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶å¯å†™æµ"><span>æ–‡ä»¶å¯å†™æµ</span></a></h3><p><strong>åˆ›å»ºæ–‡ä»¶å¯å†™æµ</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å†™æ¨¡å¼</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token number">438</span><span class="token punctuation">,</span>
  <span class="token literal-property property">fd</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>write</strong></p><ul><li>æœ¬èº«æ˜¯å¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯åŒçº§ä¸‹æ˜¯åŒæ­¥æ‰§è¡Œçš„</li><li>æ–‡ä»¶å¯å†™æµåªæ”¯æŒä¼ å…¥ Buffer æˆ–è€… å­—ç¬¦ä¸²</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;çƒœçƒœæœ€å¸…&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log1111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log2222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>open</strong></p><ul><li>åªè¦æ‰§è¡Œäº† createWriteStream å°±ä¼šè§¦å‘</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæ–‡ä»¶æ‰“å¼€&quot;</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>close</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæ–‡ä»¶å…³é—­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>end</strong></p><ul><li>end æ‰§è¡Œä¹‹åä»£è¡¨ç€æ•°æ®å†™å…¥æ“ä½œå®Œæˆ</li><li>endä¹‹åä¸èƒ½è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¼ å‚å®ç°</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>ws<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;endä¹‹å&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>error</strong></p><ul><li>è¯­æ³•é”™è¯¯ä¼šå¯¼è‡´å µå¡ï¼Œerror å›è°ƒä¸ä¼šè§¦å‘</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logå‡ºé”™äº†&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="write-æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#write-æ‰§è¡Œæµç¨‹"><span>Write æ‰§è¡Œæµç¨‹</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// write æ–¹æ³•çš„æ‰§è¡Œæµç¨‹</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token comment">// ç¼“å­˜åŒºå¤§å°ï¼Œå•ä½å­—èŠ‚ï¼Œé»˜è®¤16KB</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> flag <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

flag <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// å¦‚æœ flag ä¸º false å¹¶ä¸æ˜¯è¯´æ˜å½“å‰æ•°æ®ä¸èƒ½è¢«æ‰§è¡Œå†™å…¥ï¼Œè€Œæ˜¯ä»£è¡¨ç€å½“å‰çš„æ¶ˆè´¹é€Ÿåº¦å¤§äºç”Ÿäº§é€Ÿåº¦</span>
flag <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230821165704136.png" alt="image-20230821165704136" tabindex="0" loading="lazy"><figcaption>image-20230821165704136</figcaption></figure><ul><li>ç¬¬ä¸€æ¬¡è°ƒç”¨ write æ–¹æ³•æ—¶æ˜¯å°†æ•°æ®ç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ä¸­</li><li>ç¬¬äºŒæ¬¡å¼€å§‹ write æ–¹æ³•å°±æ˜¯å°†æ•°æ®å†™å…¥è‡³ç¼“å­˜ä¸­</li><li>ç”Ÿäº§é€Ÿåº¦å’Œ æ¶ˆè´¹é€Ÿåº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç”Ÿäº§é€Ÿåº¦è¦æ¯”æ¶ˆè´¹é€Ÿåº¦å¿«å¾ˆå¤š</li><li>å½“ flag ä¸º false ä¹‹åå¹¶ä¸æ„å‘³ç€å½“å‰æ¬¡çš„æ•°æ®ä¸èƒ½è¢«å†™å…¥äº†ã€‚ä½†æ˜¯æˆ‘ä»¬åº”è¯¥å‘Šä¹‹æ•°æ®çš„ç”Ÿäº§è€…ï¼Œå½“å‰çš„æ¶ˆè´¹é€Ÿåº¦å·²ç»è·Ÿä¸ä¸Šç”Ÿäº§é€Ÿåº¦äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†å¯è¯»æµçš„æ¨¡å—ä¿®æ”¹ä¸ºæš‚åœæ¨¡å¼ã€‚</li><li>å½“æ•°æ®ç”Ÿäº§è€…æš‚åœä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šæ…¢æ…¢çš„æ¶ˆåŒ–å®ƒå†…éƒ¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç›´åˆ°å¯ä»¥å†æ¬¡è¢«æ‰§è¡Œå†™å…¥æ“ä½œ</li><li>å½“ç¼“å†²åŒºå¯ä»¥ç»§ç»­å†™å…¥æ•°æ®æ—¶å¦‚ä½•è®©ç”Ÿäº§è€…çŸ¥é“ï¼Ÿdrain äº‹ä»¶</li></ul><h3 id="drain-ä¸å†™å…¥é€Ÿåº¦" tabindex="-1"><a class="header-anchor" href="#drain-ä¸å†™å…¥é€Ÿåº¦"><span>drain ä¸å†™å…¥é€Ÿåº¦</span></a></h3><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>åœ¨ Node.js ä¸­ï¼Œæ–‡ä»¶å†™å…¥æµï¼ˆWriteStreamï¼‰æä¾›äº† drain äº‹ä»¶ã€‚å½“å¯å†™æµçš„ç¼“å†²åŒºå·²æ»¡å¹¶ä¸”ç¼“å†²åŒºä¸­çš„æ•°æ®å·²ç»å…¨éƒ¨å†™å…¥åˆ°åº•å±‚ç³»ç»Ÿæ—¶ï¼Œä¼šè§¦å‘ drain äº‹ä»¶ã€‚</p><p>drain äº‹ä»¶çš„ä¸»è¦ç›®çš„æ˜¯åœ¨å†™å…¥å¤§é‡æ•°æ®æ—¶ï¼Œé¿å…å†…å­˜æ¶ˆè€—è¿‡é«˜ã€‚å½“å¯å†™æµçš„ç¼“å†²åŒºæ»¡æ—¶ï¼Œå†™å…¥æ“ä½œå°†æš‚åœï¼Œç›´åˆ°ç¼“å†²åŒºä¸­çš„æ•°æ®è¢«å®Œå…¨æ¶ˆè€—åæ‰èƒ½ç»§ç»­å†™å…¥ã€‚drain äº‹ä»¶å‘ŠçŸ¥åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­å†™å…¥æ•°æ®ï¼Œå› æ­¤å®ƒå¯ä»¥ç”¨äºæ§åˆ¶æ•°æ®çš„æµé‡ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨å¯å†™æµå†™å…¥æ–‡ä»¶æ—¶ï¼Œå¦‚æœå†™å…¥é€Ÿåº¦è¿‡å¿«ï¼Œç¼“å†²åŒºå¯èƒ½ä¼šåœ¨å¤„ç†å‰çš„æ•°æ®ä¹‹å‰æ»¡æ»¡çš„ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨ drain äº‹ä»¶æ¥åˆ¤æ–­ä½•æ—¶å¯ä»¥ç»§ç»­å†™å…¥ï¼Œä»¥é¿å…å†…å­˜æº¢å‡ºã€‚åœ¨ drain äº‹ä»¶ä¸­å¯ä»¥ç»§ç»­å†™å…¥æ•°æ®ï¼Œä»¥ç¡®ä¿æ•°æ®èƒ½å¤ŸæŒç»­æµåŠ¨è€Œä¸ä¼šç§¯å‹åœ¨å†…å­˜ä¸­ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œdrain äº‹ä»¶ç”¨äºåœ¨å¯å†™æµçš„ç¼“å†²åŒºå·²æ»¡ä¸”æ•°æ®å·²å…¨éƒ¨å†™å…¥åï¼Œé€šçŸ¥åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­å†™å…¥æ•°æ®ï¼Œä»¥æ§åˆ¶æ•°æ®çš„æµé‡ã€‚</p></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * éœ€æ±‚ï¼šâ€œç”Ÿè€Œæ— ç•â€ å†™å…¥æŒ‡å®šçš„æ–‡ä»¶
 * 01 ä¸€æ¬¡æ€§å†™å…¥
 * 02 åˆ†æ‰¹å†™å…¥
 * å¯¹æ¯”ï¼š
 */</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//* ä¸€æ¬¡æ€§å†™å…¥</span>
<span class="token comment">// ws.write(&quot;ç”Ÿè€Œæ— ç•&quot;);</span>

<span class="token comment">//* åˆ†æ‰¹å†™å…¥ï¼Œæ§åˆ¶é€Ÿåº¦</span>
<span class="token keyword">let</span> source <span class="token operator">=</span> <span class="token string">&quot;ç”Ÿè€Œæ— ç•&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">executeWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">!==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>num<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">executeWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;drain&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logdrain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">executeWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="èƒŒå‹æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#èƒŒå‹æœºåˆ¶"><span>èƒŒå‹æœºåˆ¶</span></a></h3><p><strong>æ•°æ®è¯»å†™æ—¶å¯èƒ½å­˜åœ¨çš„é—®é¢˜</strong></p><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230822105640426.png" alt="image-20230822105640426" tabindex="0" loading="lazy"><figcaption>image-20230822105640426</figcaption></figure><ul><li>ç£ç›˜è¯»å–é€Ÿåº¦è¿œè¿œè¦å¤§äºç£ç›˜å†™å…¥é€Ÿåº¦çš„ï¼ˆäº§èƒ½è¿‡å‰©ï¼‰</li><li>å†…å­˜æº¢å‡ºã€GCé¢‘ç¹è°ƒç”¨ã€å…¶ä»–è¿›ç¨‹å˜æ…¢</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230822110759530.png" alt="image-20230822110759530" tabindex="0" loading="lazy"><figcaption>image-20230822110759530</figcaption></figure><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230822111239488.png" alt="image-20230822111239488" tabindex="0" loading="lazy"><figcaption>image-20230822111239488</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>åœ¨Node.jsä¸­ï¼ŒèƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶æ˜¯ä¸€ç§ç”¨äºå¤„ç†æ•°æ®æµçš„æµé‡æ§åˆ¶æ–¹å¼ã€‚å½“æ•°æ®ç”Ÿäº§è€…ç”Ÿæˆæ•°æ®çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ•°æ®çš„é€Ÿåº¦æ—¶ï¼ŒèƒŒå‹æœºåˆ¶å¯ä»¥å¸®åŠ©æ¶ˆè´¹è€…æœ‰æ•ˆåœ°æ§åˆ¶æ•°æ®æµï¼Œç¡®ä¿æ¶ˆè´¹è€…ä¸è¢«è¿‡è½½ã€‚</p><p>èƒŒå‹æœºåˆ¶é€šè¿‡åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æ’å…¥ç¼“å†²åŒºæ¥å®ç°ã€‚å½“æ¶ˆè´¹è€…æ— æ³•åŠæ—¶å¤„ç†æ•°æ®æ—¶ï¼Œç”Ÿäº§è€…çš„æ•°æ®å°†æš‚æ—¶å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œç›´åˆ°æ¶ˆè´¹è€…æœ‰èƒ½åŠ›å¤„ç†å®ƒä»¬ä¸ºæ­¢ã€‚è¿™æ ·å¯ä»¥é¿å…ç”Ÿäº§è€…çš„æ•°æ®è¿‡è½½å’Œæ¶ˆè´¹è€…çš„é˜»å¡ã€‚</p><p>åœ¨Node.jsä¸­ï¼ŒèƒŒå‹æœºåˆ¶ä¸»è¦é€šè¿‡å¯å†™æµï¼ˆWritable Streamï¼‰å’Œå¯è¯»æµï¼ˆReadable Streamï¼‰ä¹‹é—´çš„äº‹ä»¶æ¥å®ç°ã€‚å½“å¯å†™æµéœ€è¦æš‚åœå†™å…¥æ•°æ®æ—¶ï¼Œå®ƒä¼šè§¦å‘&quot;drain&quot;äº‹ä»¶ï¼Œå‘ŠçŸ¥ç”Ÿäº§è€…å¯ä»¥ç»§ç»­å†™å…¥æ•°æ®ã€‚è€Œå½“å¯è¯»æµæ— æ³•ç«‹å³æ¶ˆè´¹æ‰€æœ‰å¯ç”¨æ•°æ®æ—¶ï¼Œå®ƒä¼šè§¦å‘&quot;data&quot;äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨æ•°æ®è¢«æ¶ˆè´¹åè§¦å‘&quot;end&quot;äº‹ä»¶ã€‚</p><p>ä½¿ç”¨èƒŒå‹æœºåˆ¶å¯ä»¥ç¡®ä¿æ•°æ®æµçš„å¹³è¡¡ï¼Œé¿å…ä¸Šä¸‹æ¸¸æ•°æ®å¤„ç†çš„ä¸å¹³è¡¡ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p></div><p><strong>Nodejs çš„ stream å·²ç»å®ç°äº†èƒŒå‹æœºåˆ¶ï¼špipe</strong></p><p><strong>pipe å®ç°åŸç†</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// pipe æ–¹æ³•å†…éƒ¨å®ç°åŸç†</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  flag <span class="token operator">=</span> ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logå†™å®Œäº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rs<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è§¦å‘æ—¶ï¼Œä»£è¡¨æ–‡ä»¶å¯å†™æµä¸­æœ‰æ–°çš„ç©ºé—´å¯ä»¥è¢«å†™å…¥äº†</span>
ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;drain&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rs<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç”¨ pipe æ›¿ä»£</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// pipe æ–¹æ³•å†…éƒ¨å®ç°åŸç†</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// let flag = true;</span>
<span class="token comment">// rs.on(&quot;data&quot;, (chunk) =&gt; {</span>
<span class="token comment">//   flag = ws.write(chunk, () =&gt; {</span>
<span class="token comment">//     console.log(&quot;GodX------&gt;logå†™å®Œäº†&quot;);</span>
<span class="token comment">//   });</span>
<span class="token comment">//   if (!flag) {</span>
<span class="token comment">//     rs.pause();</span>
<span class="token comment">//   }</span>
<span class="token comment">// });</span>

<span class="token comment">// // è§¦å‘æ—¶ï¼Œä»£è¡¨æ–‡ä»¶å¯å†™æµä¸­æœ‰æ–°çš„ç©ºé—´å¯ä»¥è¢«å†™å…¥äº†</span>
<span class="token comment">// ws.on(&quot;drain&quot;, () =&gt; {</span>
<span class="token comment">//   rs.resume();</span>
<span class="token comment">// });</span>

rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¨¡æ‹Ÿæ–‡ä»¶å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#æ¨¡æ‹Ÿæ–‡ä»¶å¯è¯»æµ"><span>æ¨¡æ‹Ÿæ–‡ä»¶å¯è¯»æµ</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// å¼•å…¥ fs æ¨¡å—ï¼Œç”¨äºæ–‡ä»¶æ“ä½œ</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¼•å…¥ path æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶è·¯å¾„</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¼•å…¥ EventEmitter æ¨¡å—ï¼Œç”¨äºåˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶</span>
<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®šä¹‰ä¸€ä¸ªç±» MyFileReadStreamï¼Œç»§æ‰¿è‡ª EventEmitterï¼Œç”¨äºæ¨¡æ‹Ÿæ–‡ä»¶å¯è¯»æµ</span>
<span class="token keyword">class</span> <span class="token class-name">MyFileReadStream</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å’Œä¸€äº›å¯é€‰å‚æ•°</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">=</span> options<span class="token punctuation">.</span>flags <span class="token operator">||</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">;</span> <span class="token comment">// æ ‡å¿—ä½ï¼Œè¡¨ç¤ºä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> options<span class="token punctuation">.</span>mode <span class="token operator">||</span> <span class="token number">438</span><span class="token punctuation">;</span> <span class="token comment">// æƒé™ä½ï¼Œè¡¨ç¤ºå…«è¿›åˆ¶æ•° 0666ï¼Œå³æ–‡ä»¶æ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–ç”¨æˆ·éƒ½æœ‰è¯»å†™æƒé™</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>autoClose <span class="token operator">=</span> options<span class="token punctuation">.</span>autoClose <span class="token operator">||</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦è‡ªåŠ¨å…³é—­æ–‡ä»¶</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> options<span class="token punctuation">.</span>start <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å¼€å§‹è¯»å–çš„ä½ç½®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> options<span class="token punctuation">.</span>end<span class="token punctuation">;</span> <span class="token comment">// ç»“æŸè¯»å–çš„ä½ç½®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>highWaterMark <span class="token operator">=</span> options<span class="token punctuation">.</span>highWaterMark <span class="token operator">||</span> <span class="token number">64</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">// æ¯æ¬¡è¯»å–çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º 64KB</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>readOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å·²ç»è¯»å–çš„å­—èŠ‚æ•°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨ open æ–¹æ³•æ‰“å¼€æ–‡ä»¶</span>
    <span class="token comment">// ç›‘å¬æ–°çš„äº‹ä»¶ï¼Œå¦‚æœæœ‰ data äº‹ä»¶ï¼Œåˆ™è°ƒç”¨ read æ–¹æ³•å¼€å§‹è¯»å–æ•°æ®</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;newListener&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è°ƒç”¨åŸç”Ÿ open æ–¹æ³•æ¥æ‰“å¼€æŒ‡å®šä½ç½®ä¸Šçš„æ–‡ä»¶ï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</span>
    fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flags<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mode<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœå‡ºé”™ï¼Œåˆ™è§¦å‘ error äº‹ä»¶ï¼Œå¹¶ä¼ é€’é”™è¯¯å¯¹è±¡</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å¦‚æœæˆåŠŸï¼Œåˆ™å°†æ–‡ä»¶æè¿°ç¬¦èµ‹å€¼ç»™ this.fdï¼Œå¹¶è§¦å‘ open äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ–‡ä»¶æè¿°ç¬¦</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> fd<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœ this.fd ä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¯´æ˜æ–‡ä»¶è¿˜æ²¡æœ‰æ‰“å¼€ï¼Œåˆ™ç­‰å¾… open äº‹ä»¶å†è°ƒç”¨ read æ–¹æ³•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fd <span class="token operator">!==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº bufï¼Œå¤§å°ä¸º highWaterMark</span>
    <span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>highWaterMark<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¡ç®—æœ¬æ¬¡è¦è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¦‚æœæœ‰ end å‚æ•°ï¼Œåˆ™å– end å’Œ readOffset çš„å·®å€¼å’Œ highWaterMark çš„è¾ƒå°å€¼ï¼Œå¦åˆ™å°±æ˜¯ highWaterMark</span>
    <span class="token keyword">let</span> howMuchToRead <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readOffset <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>highWaterMark<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>highWaterMark<span class="token punctuation">;</span>
    <span class="token comment">// è°ƒç”¨åŸç”Ÿ read æ–¹æ³•æ¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</span>
    fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> howMuchToRead<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readOffset<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> readBytes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœæœ‰æ•°æ®ï¼Œåˆ™å°†å·²è¯»å–çš„å­—èŠ‚æ•°ç´¯åŠ åˆ° readOffsetï¼Œå¹¶è§¦å‘ data äº‹ä»¶ï¼Œå¹¶ä¼ é€’è¯»å–åˆ°çš„æ•°æ®ï¼ˆæˆªå–æœ‰æ•ˆéƒ¨åˆ†ï¼‰</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>readBytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>readOffset <span class="token operator">+=</span> readBytes<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> readBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»§ç»­è°ƒç”¨ read æ–¹æ³•è¯»å–ä¸‹ä¸€æ®µæ•°æ®</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ™è¯´æ˜å·²ç»è¯»å®Œäº†ï¼Œè§¦å‘ end äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ close æ–¹æ³•å…³é—­æ–‡ä»¶</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è°ƒç”¨åŸç”Ÿ close æ–¹æ³•æ¥å…³é—­æ–‡ä»¶ï¼Œæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è§¦å‘ close äº‹ä»¶</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆ›å»ºä¸€ä¸ª MyFileReadStream å®ä¾‹ï¼Œä¼ å…¥ä¸€ä¸ª test.txt æ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶è®¾ç½®ä¸€äº›å‚æ•°ï¼Œå¦‚ç»“æŸä½ç½®ä¸º 11ï¼Œæ¯æ¬¡è¯»å–çš„å­—èŠ‚æ•°ä¸º 3</span>
<span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyFileReadStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logopen&quot;</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logerr&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logchunk&quot;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logclose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logend&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é“¾è¡¨ç»“æ„" tabindex="-1"><a class="header-anchor" href="#é“¾è¡¨ç»“æ„"><span>é“¾è¡¨ç»“æ„</span></a></h3><p><strong>ä¸ºä»€ä¹ˆä¸é‡‡ç”¨æ•°ç»„å­˜å‚¨æ•°æ®ï¼Ÿ</strong></p><ul><li>æ•°ç»„å­˜å‚¨æ•°æ®çš„é•¿åº¦å…·æœ‰ä¸Šé™</li><li>æ•°ç»„å­˜åœ¨å¡Œé™·é—®é¢˜ï¼ˆæ’å…¥å’Œåˆ é™¤æ“ä½œä¼šç§»åŠ¨å…¶ä»–å…ƒç´ çš„ä½ç½®ï¼‰</li></ul><p><strong>ä»€ä¹ˆæ˜¯é“¾è¡¨ï¼Ÿ</strong></p><ul><li>é“¾è¡¨æ˜¯ä¸€ç³»åˆ—èŠ‚ç‚¹çš„é›†åˆ</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å…·æœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å±æ€§</li></ul><p><strong>é“¾è¡¨åˆ†ç±»</strong></p><ul><li>åŒå‘é“¾è¡¨</li><li>å•å‘é“¾è¡¨</li><li>å¾ªç¯é“¾è¡¨</li></ul><p><strong>é“¾è¡¨çš„ä½œç”¨</strong></p><p>ç”¨æ¥å­˜æ”¾æ•°æ®</p><h3 id="å•å‘é“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#å•å‘é“¾è¡¨"><span>å•å‘é“¾è¡¨</span></a></h3><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230824154701076.png" alt="image-20230824154701076" tabindex="0" loading="lazy"><figcaption>image-20230824154701076</figcaption></figure><p><strong>æ’å…¥</strong></p><ul><li>åœ¨é“¾è¡¨å¤´éƒ¨æ’å…¥</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230824161252583.png" alt="image-20230824161252583" tabindex="0" loading="lazy"><figcaption>image-20230824161252583</figcaption></figure><ul><li>åœ¨æŒ‡å®šä½ç½®æ’å…¥</li></ul><figure><img src="https://raw.githubusercontent.com/GodX-18/picBed/main/image-20230824161420194.png" alt="image-20230824161420194" tabindex="0" loading="lazy"><figcaption>image-20230824161420194</figcaption></figure><p><strong>ä»£ç å®ç°</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// é“¾è¡¨èŠ‚ç‚¹</span>
<span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span> <span class="token comment">// å­˜æ”¾å…·ä½“çš„æ•°æ®å†…å®¹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span> <span class="token comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// é“¾è¡¨</span>
<span class="token keyword">class</span> <span class="token class-name">LinkedList</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">head<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">_getNode</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;cross the border&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> currentNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>head<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> index<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      currentNode <span class="token operator">=</span> currentNode<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> currentNode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element <span class="token operator">=</span> index<span class="token punctuation">;</span>
      index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;cross the border&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> head <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>head<span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜åŸæœ‰ head çš„æŒ‡å‘</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> preNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getNode</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      preNode<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> preNode<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rmNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rmNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>head<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rmNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> rmNode<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> preNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getNode</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rmNode <span class="token operator">=</span> preNode<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
      <span class="token comment">//   let nextNode = this._getNode(index + 1);</span>
      <span class="token comment">//   preNode.next = nextNode;</span>
      preNode<span class="token punctuation">.</span>next <span class="token operator">=</span> rmNode<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> rmNode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">set</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getNode</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getNode</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>head <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> l1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;node1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;node2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;node3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// let a = l1.get(1);</span>
<span class="token comment">// l1.remove(1);</span>
l1<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å•å‘é“¾è¡¨å®ç°é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#å•å‘é“¾è¡¨å®ç°é˜Ÿåˆ—"><span>å•å‘é“¾è¡¨å®ç°é˜Ÿåˆ—</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Queue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>linkedList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿›é˜Ÿåˆ—</span>
  <span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>linkedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å‡ºé˜Ÿåˆ—</span>
  <span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>linkedList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Queue<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

q<span class="token punctuation">.</span><span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token string">&quot;node1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token string">&quot;node2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> del <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¨¡æ‹Ÿæ–‡ä»¶å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#æ¨¡æ‹Ÿæ–‡ä»¶å¯å†™æµ"><span>æ¨¡æ‹Ÿæ–‡ä»¶å¯å†™æµ</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;events&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Queue <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../é“¾è¡¨/linked-queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyWriteStream</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">=</span> options<span class="token punctuation">.</span>flags <span class="token operator">||</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> options<span class="token punctuation">.</span>mode <span class="token operator">||</span> <span class="token number">438</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>autoClose <span class="token operator">=</span> options<span class="token punctuation">.</span>autoClose <span class="token operator">||</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> options<span class="token punctuation">.</span>start <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>encoding <span class="token operator">=</span> options<span class="token punctuation">.</span>encoding <span class="token operator">||</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>highWaterMark <span class="token operator">=</span> options<span class="token punctuation">.</span>highWaterMark <span class="token operator">||</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>writeOffset <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writeOffset <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>writing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦æ­£åœ¨å†™å…¥</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>writeLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// ç´¯è®¡å†™å…¥é‡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>needDrain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åŸç”Ÿ fs.open</span>
    fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flags<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// æ­£å¸¸æ‰“å¼€æ–‡ä»¶</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> fd<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç»Ÿä¸€ç±»å‹ï¼Œæ–¹ä¾¿é•¿åº¦è®¡ç®—</span>
    chunk <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">?</span> chunk <span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>writeLen <span class="token operator">+=</span> chunk<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writeLen <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>highWaterMark<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>needDrain <span class="token operator">=</span> <span class="token operator">!</span>flag<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>writing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å½“å‰æ­£åœ¨æ‰§è¡Œå†™å…¥ï¼Œæ‰€ä»¥å†…å®¹åº”è¯¥æ’é˜Ÿï¼Œæ”¾å…¥ç¼“å­˜åŒº</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">enQueue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>writing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// å½“å‰ä¸æ˜¯æ­£åœ¨å†™å…¥ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œå†™å…¥</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¸…ç©ºæ’é˜Ÿçš„å†…å®¹</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_clearbuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> flag<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">_write</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fd <span class="token operator">!==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fd<span class="token punctuation">,</span> chunk<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> chunk<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>writeOffset<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> written</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>writeOffset <span class="token operator">+=</span> written<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>writeLen <span class="token operator">-=</span> written<span class="token punctuation">;</span>

      cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">_clearbuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">deQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;log&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> cb <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>element<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_clearbuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// è§¦å‘drain äº‹ä»¶</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>needDrain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>needDrain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;drain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyWriteStream</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;zx.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">highWaterMark</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logopen&quot;</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;godx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæˆåŠŸå†™å…¥1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæˆåŠŸå†™å…¥2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;nb&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logæˆåŠŸå†™å…¥3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;drain&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GodX------&gt;logdrain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 1046529973@qq.com">GodX</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/01-Node%E5%9F%BA%E7%A1%80.html" aria-label="Node åŸºç¡€"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-structure" style=""></span>Node åŸºç¡€</div></a><a class="route-link nav-link next" href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/Nodejs%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/03-%E9%80%9A%E4%BF%A1.html" aria-label="é€šä¿¡"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">é€šä¿¡<span class="font-icon icon iconfont icon-rss" style=""></span></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2024 GodX </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-oXp7PBbS.js" defer></script>
  </body>
</html>
